<!DOCTYPE html>
<html lang="en" data-accent-color="grass" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>pyexasol.connection - pyexasol</title><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=aeb20d5c" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    
    <meta property="og:type" content="website"/><meta property="og:title" content="pyexasol.connection"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../index.html">
      <img class="light-logo" src="../../_static/light-exasol-logo.svg" alt="pyexasol" height="28" loading="lazy" />
      <img class="dark-logo" src="../../_static/dark-exasol-logo.svg" alt="pyexasol" height="28" loading="lazy" />
      <strong>pyexasol</strong>
    </a>
    <div class="sy-head-nav" id="HeadNav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="nav-versions">
    <button type="button" aria-label="Versions">
      <span class="md:hidden">Versions</span>
      <span class="hidden md:inline">master</span>
      <i class="i-lucide chevron-down"></i>
    </button>
    <div class="nav-versions-choices"><ul><li><a href="connection.html">master</a></li></ul></div>
  </div><div class="sy-head-socials">
  <a href="https://github.com/exasol/pyexasol" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="HeadNav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-person" viewBox="0 0 16 16" aria-hidden="true"><path d="M10.561 8.073a6.005 6.005 0 0 1 3.432 5.142.75.75 0 1 1-1.498.07 4.5 4.5 0 0 0-8.99 0 .75.75 0 0 1-1.498-.07 6.004 6.004 0 0 1 3.431-5.142 3.999 3.999 0 1 1 5.123 0ZM10.5 5a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"></path></svg> User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide.html"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-tools" viewBox="0 0 16 16" aria-hidden="true"><path d="M5.433 2.304A4.492 4.492 0 0 0 3.5 6c0 1.598.832 3.002 2.09 3.802.518.328.929.923.902 1.64v.008l-.164 3.337a.75.75 0 1 1-1.498-.073l.163-3.33c.002-.085-.05-.216-.207-.316A5.996 5.996 0 0 1 2 6a5.993 5.993 0 0 1 2.567-4.92 1.482 1.482 0 0 1 1.673-.04c.462.296.76.827.76 1.423v2.82c0 .082.041.16.11.206l.75.51a.25.25 0 0 0 .28 0l.75-.51A.249.249 0 0 0 9 5.282V2.463c0-.596.298-1.127.76-1.423a1.482 1.482 0 0 1 1.673.04A5.993 5.993 0 0 1 14 6a5.996 5.996 0 0 1-2.786 5.068c-.157.1-.209.23-.207.315l.163 3.33a.752.752 0 0 1-1.094.714.75.75 0 0 1-.404-.64l-.164-3.345c-.027-.717.384-1.312.902-1.64A4.495 4.495 0 0 0 12.5 6a4.492 4.492 0 0 0-1.933-3.696c-.024.017-.067.067-.067.16v2.818a1.75 1.75 0 0 1-.767 1.448l-.75.51a1.75 1.75 0 0 1-1.966 0l-.75-.51A1.75 1.75 0 0 1 5.5 5.282V2.463c0-.092-.043-.142-.067-.159Z"></path></svg> Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-cpu" viewBox="0 0 16 16" aria-hidden="true"><path d="M6.5.75V2h3V.75a.75.75 0 0 1 1.5 0V2h1.25c.966 0 1.75.784 1.75 1.75V5h1.25a.75.75 0 0 1 0 1.5H14v3h1.25a.75.75 0 0 1 0 1.5H14v1.25A1.75 1.75 0 0 1 12.25 14H11v1.25a.75.75 0 0 1-1.5 0V14h-3v1.25a.75.75 0 0 1-1.5 0V14H3.75A1.75 1.75 0 0 1 2 12.25V11H.75a.75.75 0 0 1 0-1.5H2v-3H.75a.75.75 0 0 1 0-1.5H2V3.75C2 2.784 2.784 2 3.75 2H5V.75a.75.75 0 0 1 1.5 0Zm5.75 11.75a.25.25 0 0 0 .25-.25v-8.5a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25ZM5.75 5h4.5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-.75.75h-4.5a.75.75 0 0 1-.75-.75v-4.5A.75.75 0 0 1 5.75 5Zm.75 4.5h3v-3h-3Z"></path></svg> API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-question" viewBox="0 0 16 16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg> FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes/changelog.html">Changes</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6"><div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">pyexasol</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../pyexasol.html"><span itemprop="name">pyexasol</span></a>
        <span>/</span>
        <meta itemprop="position" content="3" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">pyexasol.connection</strong>
        <meta itemprop="position" content="4" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for pyexasol.connection</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="kn">import</span> <span class="nn">base64</span>
</span><span data-line="2"><span class="kn">import</span> <span class="nn">getpass</span>
</span><span data-line="3"><span class="kn">import</span> <span class="nn">hashlib</span>
</span><span data-line="4"><span class="kn">import</span> <span class="nn">itertools</span>
</span><span data-line="5"><span class="kn">import</span> <span class="nn">platform</span>
</span><span data-line="6"><span class="kn">import</span> <span class="nn">random</span>
</span><span data-line="7"><span class="kn">import</span> <span class="nn">re</span>
</span><span data-line="8"><span class="kn">import</span> <span class="nn">socket</span>
</span><span data-line="9"><span class="kn">import</span> <span class="nn">ssl</span>
</span><span data-line="10"><span class="kn">import</span> <span class="nn">threading</span>
</span><span data-line="11"><span class="kn">import</span> <span class="nn">time</span>
</span><span data-line="12"><span class="kn">import</span> <span class="nn">urllib.parse</span>
</span><span data-line="13"><span class="kn">import</span> <span class="nn">zlib</span>
</span><span data-line="14"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
</span><span data-line="15">    <span class="n">NamedTuple</span><span class="p">,</span>
</span><span data-line="16">    <span class="n">Optional</span><span class="p">,</span>
</span><span data-line="17"><span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="kn">import</span> <span class="nn">rsa</span>
</span><span data-line="20"><span class="kn">import</span> <span class="nn">websocket</span>
</span><span data-line="21">
</span><span data-line="22"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">callback</span> <span class="k">as</span> <span class="n">cb</span>
</span><span data-line="23"><span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="o">*</span>
</span><span data-line="24"><span class="kn">from</span> <span class="nn">.ext</span> <span class="kn">import</span> <span class="n">ExaExtension</span>
</span><span data-line="25"><span class="kn">from</span> <span class="nn">.formatter</span> <span class="kn">import</span> <span class="n">ExaFormatter</span>
</span><span data-line="26"><span class="kn">from</span> <span class="nn">.http_transport</span> <span class="kn">import</span> <span class="p">(</span>
</span><span data-line="27">    <span class="n">ExaHttpThread</span><span class="p">,</span>
</span><span data-line="28">    <span class="n">ExaSQLExportThread</span><span class="p">,</span>
</span><span data-line="29">    <span class="n">ExaSQLImportThread</span><span class="p">,</span>
</span><span data-line="30"><span class="p">)</span>
</span><span data-line="31"><span class="kn">from</span> <span class="nn">.logger</span> <span class="kn">import</span> <span class="n">ExaLogger</span>
</span><span data-line="32"><span class="kn">from</span> <span class="nn">.meta</span> <span class="kn">import</span> <span class="n">ExaMetaData</span>
</span><span data-line="33"><span class="kn">from</span> <span class="nn">.script_output</span> <span class="kn">import</span> <span class="n">ExaScriptOutputProcess</span>
</span><span data-line="34"><span class="kn">from</span> <span class="nn">.statement</span> <span class="kn">import</span> <span class="n">ExaStatement</span>
</span><span data-line="35"><span class="kn">from</span> <span class="nn">.version</span> <span class="kn">import</span> <span class="n">__version__</span>
</span><span data-line="36">
</span><span data-line="37">
</span><span data-line="38"><span class="k">class</span> <span class="nc">Host</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span data-line="39"><span class="w">    </span><span class="sd">&quot;&quot;&quot;This represents a resolved host name with its IP address and port number.&quot;&quot;&quot;</span>
</span><span data-line="40">
</span><span data-line="41">    <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="42">    <span class="n">ip_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="43">    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="44">    <span class="n">fingerprint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="45">
</span><span data-line="46">
<div class="viewcode-block" id="ExaConnection">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection">[docs]</a>
</span><span data-line="47"><span class="k">class</span> <span class="nc">ExaConnection</span><span class="p">:</span>
</span><span data-line="48"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="49"><span class="sd">    Warning:</span>
</span><span data-line="50"><span class="sd">        Threads may share the module, but not connections</span>
</span><span data-line="51"><span class="sd">        One connection may be used by different threads, just not at the same time</span>
</span><span data-line="52"><span class="sd">        :meth:`pyexasol.ExaConnection.abort_query` is an exception,</span>
</span><span data-line="53"><span class="sd">        it is meant to be called from another thread</span>
</span><span data-line="54">
</span><span data-line="55"><span class="sd">    Note:</span>
</span><span data-line="56">
</span><span data-line="57"><span class="sd">        It is advisable to use multiprocessing instead of threading and create</span>
</span><span data-line="58"><span class="sd">        a new connection in each sub-process</span>
</span><span data-line="59">
</span><span data-line="60"><span class="sd">        Public Attributes:</span>
</span><span data-line="61"><span class="sd">            ``attr``:</span>
</span><span data-line="62"><span class="sd">                Read-only `dict` of attributes of current connection.</span>
</span><span data-line="63">
</span><span data-line="64"><span class="sd">            ``login_info``:</span>
</span><span data-line="65"><span class="sd">                Read-only ``dict`` of login information returned by second</span>
</span><span data-line="66"><span class="sd">                response of LOGIN command.</span>
</span><span data-line="67">
</span><span data-line="68"><span class="sd">            ``options``:</span>
</span><span data-line="69"><span class="sd">                Read-only ``dict`` of arguments passed to</span>
</span><span data-line="70"><span class="sd">                :meth:`pyexasol.ExaConnection.connect`.</span>
</span><span data-line="71"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="72">
</span><span data-line="73">    <span class="n">cls_statement</span> <span class="o">=</span> <span class="n">ExaStatement</span>
</span><span data-line="74">    <span class="n">cls_formatter</span> <span class="o">=</span> <span class="n">ExaFormatter</span>
</span><span data-line="75">    <span class="n">cls_logger</span> <span class="o">=</span> <span class="n">ExaLogger</span>
</span><span data-line="76">    <span class="n">cls_extension</span> <span class="o">=</span> <span class="n">ExaExtension</span>
</span><span data-line="77">    <span class="n">cls_meta</span> <span class="o">=</span> <span class="n">ExaMetaData</span>
</span><span data-line="78">
</span><span data-line="79">    <span class="n">threadsafety</span> <span class="o">=</span> <span class="mi">1</span>
</span><span data-line="80">
<div class="viewcode-block" id="ExaConnection.__init__">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.__init__">[docs]</a>
</span><span data-line="81">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="82">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="83">        <span class="n">dsn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="84">        <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="85">        <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="86">        <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span data-line="87">        <span class="n">autocommit</span><span class="o">=</span><span class="n">constant</span><span class="o">.</span><span class="n">DEFAULT_AUTOCOMMIT</span><span class="p">,</span>
</span><span data-line="88">        <span class="n">snapshot_transactions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="89">        <span class="n">connection_timeout</span><span class="o">=</span><span class="n">constant</span><span class="o">.</span><span class="n">DEFAULT_CONNECTION_TIMEOUT</span><span class="p">,</span>
</span><span data-line="90">        <span class="n">socket_timeout</span><span class="o">=</span><span class="n">constant</span><span class="o">.</span><span class="n">DEFAULT_SOCKET_TIMEOUT</span><span class="p">,</span>
</span><span data-line="91">        <span class="n">query_timeout</span><span class="o">=</span><span class="n">constant</span><span class="o">.</span><span class="n">DEFAULT_QUERY_TIMEOUT</span><span class="p">,</span>
</span><span data-line="92">        <span class="n">compression</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="93">        <span class="n">encryption</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="94">        <span class="n">fetch_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="95">        <span class="n">fetch_mapper</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="96">        <span class="n">fetch_size_bytes</span><span class="o">=</span><span class="n">constant</span><span class="o">.</span><span class="n">DEFAULT_FETCH_SIZE_BYTES</span><span class="p">,</span>
</span><span data-line="97">        <span class="n">lower_ident</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="98">        <span class="n">quote_ident</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="99">        <span class="n">json_lib</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
</span><span data-line="100">        <span class="n">verbose_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="101">        <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="102">        <span class="n">debug_logdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="103">        <span class="n">udf_output_bind_address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="104">        <span class="n">udf_output_connect_address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="105">        <span class="n">udf_output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="106">        <span class="n">http_proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="107">        <span class="n">resolve_hostnames</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="108">        <span class="n">client_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="109">        <span class="n">client_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="110">        <span class="n">client_os_username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="111">        <span class="n">protocol_version</span><span class="o">=</span><span class="n">constant</span><span class="o">.</span><span class="n">PROTOCOL_V3</span><span class="p">,</span>
</span><span data-line="112">        <span class="n">websocket_sslopt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="113">        <span class="n">access_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="114">        <span class="n">refresh_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="115">    <span class="p">):</span>
</span><span data-line="116"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="117"><span class="sd">        Exasol connection object</span>
</span><span data-line="118">
</span><span data-line="119"><span class="sd">        Args:</span>
</span><span data-line="120"><span class="sd">            dsn:</span>
</span><span data-line="121"><span class="sd">                Connection string, same format as standard JDBC / ODBC drivers</span>
</span><span data-line="122"><span class="sd">                (e.g. 10.10.127.1..11:8564)</span>
</span><span data-line="123"><span class="sd">            user:</span>
</span><span data-line="124"><span class="sd">                Username</span>
</span><span data-line="125"><span class="sd">            password:</span>
</span><span data-line="126"><span class="sd">                Password</span>
</span><span data-line="127"><span class="sd">            schema:</span>
</span><span data-line="128"><span class="sd">                Open schema after connection</span>
</span><span data-line="129"><span class="sd">                (Default: &#39;&#39;, no schema)</span>
</span><span data-line="130"><span class="sd">            autocommit:</span>
</span><span data-line="131"><span class="sd">                Enable autocommit on connection</span>
</span><span data-line="132"><span class="sd">                (Default: True)</span>
</span><span data-line="133"><span class="sd">            snapshot_transactions:</span>
</span><span data-line="134"><span class="sd">                Explicitly enable or disable snapshot transactions on connection</span>
</span><span data-line="135"><span class="sd">                (Default: None, database default)</span>
</span><span data-line="136"><span class="sd">            connection_timeout:</span>
</span><span data-line="137"><span class="sd">                Socket timeout in seconds used to establish connection</span>
</span><span data-line="138"><span class="sd">                (Default: 10)</span>
</span><span data-line="139"><span class="sd">            socket_timeout:</span>
</span><span data-line="140"><span class="sd">                Socket timeout in seconds used for requests after connection was established</span>
</span><span data-line="141"><span class="sd">                (Default: 30)</span>
</span><span data-line="142"><span class="sd">            query_timeout:</span>
</span><span data-line="143"><span class="sd">                Maximum execution time of queries before automatic abort, in seconds</span>
</span><span data-line="144"><span class="sd">                (Default: 0, no timeout)</span>
</span><span data-line="145"><span class="sd">            compression:</span>
</span><span data-line="146"><span class="sd">                Use zlib compression both for WebSocket and HTTP transport</span>
</span><span data-line="147"><span class="sd">                (Default: False)</span>
</span><span data-line="148"><span class="sd">            encryption:</span>
</span><span data-line="149"><span class="sd">                Use SSL to encrypt client-server communications for WebSocket and HTTP transport</span>
</span><span data-line="150"><span class="sd">                (Default: True)</span>
</span><span data-line="151"><span class="sd">            fetch_dict:</span>
</span><span data-line="152"><span class="sd">                Fetch result rows as dicts instead of tuples (Default: False)</span>
</span><span data-line="153"><span class="sd">            fetch_mapper:</span>
</span><span data-line="154"><span class="sd">                Use custom mapper function to convert Exasol values into</span>
</span><span data-line="155"><span class="sd">                Python objects during fetching</span>
</span><span data-line="156"><span class="sd">                (Default: None)</span>
</span><span data-line="157"><span class="sd">            fetch_size_bytes:</span>
</span><span data-line="158"><span class="sd">                Maximum size of data message for single fetch request in bytes</span>
</span><span data-line="159"><span class="sd">                (Default: 5Mb)</span>
</span><span data-line="160"><span class="sd">            lower_ident:</span>
</span><span data-line="161"><span class="sd">                Automatically lowercase identifiers (table names, column names, etc.)</span>
</span><span data-line="162"><span class="sd">                returned from relevant functions</span>
</span><span data-line="163"><span class="sd">                (Default: False)</span>
</span><span data-line="164"><span class="sd">            quote_ident:</span>
</span><span data-line="165"><span class="sd">                Add double quotes and escape identifiers passed to relevant functions</span>
</span><span data-line="166"><span class="sd">                (export_*, import_*, ext.*, etc.)</span>
</span><span data-line="167"><span class="sd">                (Default: False)</span>
</span><span data-line="168"><span class="sd">            json_lib:</span>
</span><span data-line="169"><span class="sd">                Supported values: rapidjson, ujson, orjson, json</span>
</span><span data-line="170"><span class="sd">                (Default: json)</span>
</span><span data-line="171"><span class="sd">            verbose_error:</span>
</span><span data-line="172"><span class="sd">                Display additional information when error occurs</span>
</span><span data-line="173"><span class="sd">                (Default: True)</span>
</span><span data-line="174"><span class="sd">            debug:</span>
</span><span data-line="175"><span class="sd">                Output debug information for client-server communication and</span>
</span><span data-line="176"><span class="sd">                connection attempts to STDERR</span>
</span><span data-line="177"><span class="sd">            debug_logdir:</span>
</span><span data-line="178"><span class="sd">                Store debug information into files in debug_logdir instead of</span>
</span><span data-line="179"><span class="sd">                outputting it to STDERR</span>
</span><span data-line="180"><span class="sd">            udf_output_bind_address:</span>
</span><span data-line="181"><span class="sd">                Specific server_address to bind TCP server for UDF script output</span>
</span><span data-line="182"><span class="sd">                (default: (&#39;&#39;, 0))</span>
</span><span data-line="183"><span class="sd">            udf_output_connect_address:</span>
</span><span data-line="184"><span class="sd">                Specific SCRIPT_OUTPUT_ADDRESS value to connect from Exasol to</span>
</span><span data-line="185"><span class="sd">                UDF script output server</span>
</span><span data-line="186"><span class="sd">                (default: inherited from TCP server)</span>
</span><span data-line="187"><span class="sd">            udf_output_dir:</span>
</span><span data-line="188"><span class="sd">                Directory to store captured UDF script output logs, split by</span>
</span><span data-line="189"><span class="sd">                &lt;session_id&gt;_&lt;statement_id&gt;/&lt;vm_num&gt;</span>
</span><span data-line="190"><span class="sd">            http_proxy:</span>
</span><span data-line="191"><span class="sd">                HTTP proxy string in Linux http_proxy format</span>
</span><span data-line="192"><span class="sd">                (default: None)</span>
</span><span data-line="193"><span class="sd">            resolve_hostnames:</span>
</span><span data-line="194"><span class="sd">                Explicitly resolve host names to IP addresses before connecting.</span>
</span><span data-line="195"><span class="sd">                Deactivating this will let the operating system resolve the host name</span>
</span><span data-line="196"><span class="sd">                (default: True)</span>
</span><span data-line="197"><span class="sd">            client_name:</span>
</span><span data-line="198"><span class="sd">                Custom name of client application displayed in Exasol sessions tables</span>
</span><span data-line="199"><span class="sd">                (Default: PyEXASOL)</span>
</span><span data-line="200"><span class="sd">            client_version:</span>
</span><span data-line="201"><span class="sd">                Custom version of client application</span>
</span><span data-line="202"><span class="sd">                (Default: pyexasol.__version__)</span>
</span><span data-line="203"><span class="sd">            client_os_username:</span>
</span><span data-line="204"><span class="sd">                Custom OS username displayed in Exasol sessions table</span>
</span><span data-line="205"><span class="sd">                (Default: getpass.getuser())</span>
</span><span data-line="206"><span class="sd">            protocol_version:</span>
</span><span data-line="207"><span class="sd">                Major WebSocket protocol version requested for connection</span>
</span><span data-line="208"><span class="sd">                (Default: pyexasol.PROTOCOL_V3)</span>
</span><span data-line="209"><span class="sd">            websocket_sslopt:</span>
</span><span data-line="210"><span class="sd">                Set custom SSL options for WebSocket client</span>
</span><span data-line="211"><span class="sd">                (Default: None)</span>
</span><span data-line="212"><span class="sd">            access_token:</span>
</span><span data-line="213"><span class="sd">                OpenID access token to use for the login process</span>
</span><span data-line="214"><span class="sd">            refresh_token:</span>
</span><span data-line="215"><span class="sd">                OpenID refresh token to use for the login process</span>
</span><span data-line="216"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="217">
</span><span data-line="218">        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="219">            <span class="s2">&quot;dsn&quot;</span><span class="p">:</span> <span class="n">dsn</span><span class="p">,</span>
</span><span data-line="220">            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
</span><span data-line="221">            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
</span><span data-line="222">            <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="p">,</span>
</span><span data-line="223">            <span class="s2">&quot;autocommit&quot;</span><span class="p">:</span> <span class="n">autocommit</span><span class="p">,</span>
</span><span data-line="224">            <span class="s2">&quot;snapshot_transactions&quot;</span><span class="p">:</span> <span class="n">snapshot_transactions</span><span class="p">,</span>
</span><span data-line="225">            <span class="s2">&quot;connection_timeout&quot;</span><span class="p">:</span> <span class="n">connection_timeout</span><span class="p">,</span>
</span><span data-line="226">            <span class="s2">&quot;socket_timeout&quot;</span><span class="p">:</span> <span class="n">socket_timeout</span><span class="p">,</span>
</span><span data-line="227">            <span class="s2">&quot;query_timeout&quot;</span><span class="p">:</span> <span class="n">query_timeout</span><span class="p">,</span>
</span><span data-line="228">            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">compression</span><span class="p">,</span>
</span><span data-line="229">            <span class="s2">&quot;encryption&quot;</span><span class="p">:</span> <span class="n">encryption</span><span class="p">,</span>
</span><span data-line="230">            <span class="s2">&quot;fetch_dict&quot;</span><span class="p">:</span> <span class="n">fetch_dict</span><span class="p">,</span>
</span><span data-line="231">            <span class="s2">&quot;fetch_mapper&quot;</span><span class="p">:</span> <span class="n">fetch_mapper</span><span class="p">,</span>
</span><span data-line="232">            <span class="s2">&quot;fetch_size_bytes&quot;</span><span class="p">:</span> <span class="n">fetch_size_bytes</span><span class="p">,</span>
</span><span data-line="233">            <span class="s2">&quot;lower_ident&quot;</span><span class="p">:</span> <span class="n">lower_ident</span><span class="p">,</span>
</span><span data-line="234">            <span class="s2">&quot;quote_ident&quot;</span><span class="p">:</span> <span class="n">quote_ident</span><span class="p">,</span>
</span><span data-line="235">            <span class="s2">&quot;json_lib&quot;</span><span class="p">:</span> <span class="n">json_lib</span><span class="p">,</span>
</span><span data-line="236">            <span class="s2">&quot;verbose_error&quot;</span><span class="p">:</span> <span class="n">verbose_error</span><span class="p">,</span>
</span><span data-line="237">            <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="n">debug</span><span class="p">,</span>
</span><span data-line="238">            <span class="s2">&quot;debug_logdir&quot;</span><span class="p">:</span> <span class="n">debug_logdir</span><span class="p">,</span>
</span><span data-line="239">            <span class="s2">&quot;udf_output_bind_address&quot;</span><span class="p">:</span> <span class="n">udf_output_bind_address</span><span class="p">,</span>
</span><span data-line="240">            <span class="s2">&quot;udf_output_connect_address&quot;</span><span class="p">:</span> <span class="n">udf_output_connect_address</span><span class="p">,</span>
</span><span data-line="241">            <span class="s2">&quot;udf_output_dir&quot;</span><span class="p">:</span> <span class="n">udf_output_dir</span><span class="p">,</span>
</span><span data-line="242">            <span class="s2">&quot;http_proxy&quot;</span><span class="p">:</span> <span class="n">http_proxy</span><span class="p">,</span>
</span><span data-line="243">            <span class="s2">&quot;resolve_hostnames&quot;</span><span class="p">:</span> <span class="n">resolve_hostnames</span><span class="p">,</span>
</span><span data-line="244">            <span class="s2">&quot;client_name&quot;</span><span class="p">:</span> <span class="n">client_name</span><span class="p">,</span>
</span><span data-line="245">            <span class="s2">&quot;client_version&quot;</span><span class="p">:</span> <span class="n">client_version</span><span class="p">,</span>
</span><span data-line="246">            <span class="s2">&quot;client_os_username&quot;</span><span class="p">:</span> <span class="n">client_os_username</span><span class="p">,</span>
</span><span data-line="247">            <span class="s2">&quot;protocol_version&quot;</span><span class="p">:</span> <span class="n">protocol_version</span><span class="p">,</span>
</span><span data-line="248">            <span class="s2">&quot;websocket_sslopt&quot;</span><span class="p">:</span> <span class="n">websocket_sslopt</span><span class="p">,</span>
</span><span data-line="249">            <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>
</span><span data-line="250">            <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="n">refresh_token</span><span class="p">,</span>
</span><span data-line="251">        <span class="p">}</span>
</span><span data-line="252">
</span><span data-line="253">        <span class="bp">self</span><span class="o">.</span><span class="n">login_info</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="254">        <span class="bp">self</span><span class="o">.</span><span class="n">login_time</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="255">        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="256">        <span class="bp">self</span><span class="o">.</span><span class="n">is_closed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="257">
</span><span data-line="258">        <span class="bp">self</span><span class="o">.</span><span class="n">ws_ipaddr</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="259">        <span class="bp">self</span><span class="o">.</span><span class="n">ws_port</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="260">        <span class="bp">self</span><span class="o">.</span><span class="n">ws_req_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="261">        <span class="bp">self</span><span class="o">.</span><span class="n">ws_req_time</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="262">
</span><span data-line="263">        <span class="bp">self</span><span class="o">.</span><span class="n">last_stmt</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="264">        <span class="bp">self</span><span class="o">.</span><span class="n">stmt_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="265">
</span><span data-line="266">        <span class="bp">self</span><span class="o">.</span><span class="n">json_encode</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="267">        <span class="bp">self</span><span class="o">.</span><span class="n">json_decode</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="268">
</span><span data-line="269">        <span class="bp">self</span><span class="o">.</span><span class="n">_udf_output_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="270">        <span class="bp">self</span><span class="o">.</span><span class="n">_req_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span data-line="271">
</span><span data-line="272">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_format</span><span class="p">()</span>
</span><span data-line="273">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_json</span><span class="p">()</span>
</span><span data-line="274">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_ext</span><span class="p">()</span>
</span><span data-line="275">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_meta</span><span class="p">()</span>
</span><span data-line="276">
</span><span data-line="277">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_logger</span><span class="p">()</span>
</span><span data-line="278">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_ws</span><span class="p">()</span>
</span><span data-line="279">
</span><span data-line="280">        <span class="bp">self</span><span class="o">.</span><span class="n">_login</span><span class="p">()</span>
</span><span data-line="281">        <span class="bp">self</span><span class="o">.</span><span class="n">get_attr</span><span class="p">()</span></div>

</span><span data-line="282">
<div class="viewcode-block" id="ExaConnection.execute">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.execute">[docs]</a>
</span><span data-line="283">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExaStatement</span><span class="p">:</span>
</span><span data-line="284"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="285"><span class="sd">        Execute SQL query with optional query formatting parameters</span>
</span><span data-line="286">
</span><span data-line="287"><span class="sd">        Args:</span>
</span><span data-line="288"><span class="sd">            query:</span>
</span><span data-line="289"><span class="sd">                SQL query text, possibly with placeholders</span>
</span><span data-line="290"><span class="sd">            query_params:</span>
</span><span data-line="291"><span class="sd">                 Values for placeholders</span>
</span><span data-line="292">
</span><span data-line="293"><span class="sd">        Returns:</span>
</span><span data-line="294"><span class="sd">            ExaStatement object</span>
</span><span data-line="295">
</span><span data-line="296"><span class="sd">        Examples:</span>
</span><span data-line="297">
</span><span data-line="298"><span class="sd">            &gt;&gt;&gt; con = ExaConnection(...)</span>
</span><span data-line="299"><span class="sd">            &gt;&gt;&gt; con.execute(</span>
</span><span data-line="300"><span class="sd">            ...        query=&quot;SELECT * FROM {table!i} WHERE col1={col1}&quot;,</span>
</span><span data-line="301"><span class="sd">            ...        query_params={&#39;table&#39;: &#39;users&#39;, &#39;col1&#39;:&#39;bar&#39;}</span>
</span><span data-line="302"><span class="sd">            ...)</span>
</span><span data-line="303"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="304">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cls_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">query_params</span><span class="p">)</span></div>

</span><span data-line="305">
<div class="viewcode-block" id="ExaConnection.execute_udf_output">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.execute_udf_output">[docs]</a>
</span><span data-line="306">    <span class="k">def</span> <span class="nf">execute_udf_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="307"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="308"><span class="sd">        Execute SQL query with UDF script, capture output</span>
</span><span data-line="309">
</span><span data-line="310"><span class="sd">        Note:</span>
</span><span data-line="311"><span class="sd">            Exasol should be able to open connection to the machine where current script is running.</span>
</span><span data-line="312"><span class="sd">            It is usually OK in the same data centre, but it is normally not working</span>
</span><span data-line="313"><span class="sd">            if you try to run this function on local laptop.</span>
</span><span data-line="314">
</span><span data-line="315"><span class="sd">        Args:</span>
</span><span data-line="316"><span class="sd">            query:</span>
</span><span data-line="317"><span class="sd">                SQL query text, possibly with placeholders</span>
</span><span data-line="318"><span class="sd">            query_params:</span>
</span><span data-line="319"><span class="sd">                Values for placeholders |</span>
</span><span data-line="320">
</span><span data-line="321"><span class="sd">        Returns:</span>
</span><span data-line="322"><span class="sd">            Return tuple with two elements: (1) instance of :class:`pyexasol.ExaStatement`</span>
</span><span data-line="323"><span class="sd">            and (2) list of :class:`Path` objects for script output log files.</span>
</span><span data-line="324">
</span><span data-line="325"><span class="sd">        Attention:</span>
</span><span data-line="326"><span class="sd">            Exasol should be able to open connection to the machine where current script is running</span>
</span><span data-line="327">
</span><span data-line="328"><span class="sd">        Examples:</span>
</span><span data-line="329"><span class="sd">            &gt;&gt;&gt; con = ExaConnection(...)</span>
</span><span data-line="330"><span class="sd">            &gt;&gt;&gt; stmt, output_files = con.execute_udf_output(</span>
</span><span data-line="331"><span class="sd">            ...        query=&quot;SELECT * FROM {table!i} WHERE col1={col1}&quot;,</span>
</span><span data-line="332"><span class="sd">            ...        query_params={&#39;table&#39;: &#39;users&#39;, &#39;col1&#39;:&#39;bar&#39;}</span>
</span><span data-line="333"><span class="sd">            ...)</span>
</span><span data-line="334"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="335">        <span class="n">stmt_output_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stmt_output_dir</span><span class="p">()</span>
</span><span data-line="336">
</span><span data-line="337">        <span class="n">script_output</span> <span class="o">=</span> <span class="n">ExaScriptOutputProcess</span><span class="p">(</span>
</span><span data-line="338">            <span class="p">(</span>
</span><span data-line="339">                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;udf_output_bind_address&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="340">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;udf_output_bind_address&quot;</span><span class="p">]</span>
</span><span data-line="341">                <span class="k">else</span> <span class="kc">None</span>
</span><span data-line="342">            <span class="p">),</span>
</span><span data-line="343">            <span class="p">(</span>
</span><span data-line="344">                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;udf_output_bind_address&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="345">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;udf_output_bind_address&quot;</span><span class="p">]</span>
</span><span data-line="346">                <span class="k">else</span> <span class="kc">None</span>
</span><span data-line="347">            <span class="p">),</span>
</span><span data-line="348">            <span class="n">stmt_output_dir</span><span class="p">,</span>
</span><span data-line="349">        <span class="p">)</span>
</span><span data-line="350">
</span><span data-line="351">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="352">            <span class="n">script_output</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span data-line="353">
</span><span data-line="354">            <span class="c1"># This option is useful to get around complex network setups, like Exasol running in Docker containers</span>
</span><span data-line="355">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;udf_output_connect_address&quot;</span><span class="p">]:</span>
</span><span data-line="356">                <span class="n">address</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;udf_output_connect_address&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;udf_output_connect_address&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="357">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="358">                <span class="n">address</span> <span class="o">=</span> <span class="n">script_output</span><span class="o">.</span><span class="n">get_output_address</span><span class="p">()</span>
</span><span data-line="359">
</span><span data-line="360">            <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span data-line="361">                <span class="s2">&quot;ALTER SESSION SET SCRIPT_OUTPUT_ADDRESS = </span><span class="si">{address}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span data-line="362">                <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">address</span><span class="p">},</span>
</span><span data-line="363">            <span class="p">)</span>
</span><span data-line="364">
</span><span data-line="365">            <span class="n">stmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">query_params</span><span class="p">)</span>
</span><span data-line="366">            <span class="n">log_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">stmt_output_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.log&quot;</span><span class="p">)))</span>
</span><span data-line="367">
</span><span data-line="368">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="369">                <span class="n">script_output</span><span class="o">.</span><span class="n">join_with_exc</span><span class="p">()</span>
</span><span data-line="370">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="371">                <span class="c1"># In some cases Exasol does not run any VM&#39;s even when UDF scripts are being called</span>
</span><span data-line="372">                <span class="c1"># In this case we must terminate TCP server, since it won&#39;t stop automatically</span>
</span><span data-line="373">                <span class="n">script_output</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span data-line="374">                <span class="n">script_output</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span data-line="375">        <span class="k">except</span> <span class="n">ExaQueryError</span><span class="p">:</span>
</span><span data-line="376">            <span class="n">script_output</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span data-line="377">            <span class="n">script_output</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span data-line="378">
</span><span data-line="379">            <span class="k">raise</span>
</span><span data-line="380">
</span><span data-line="381">        <span class="k">return</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">log_files</span></div>

</span><span data-line="382">
<div class="viewcode-block" id="ExaConnection.commit">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.commit">[docs]</a>
</span><span data-line="383">    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="384"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper for query &#39;COMMIT&#39;&quot;&quot;&quot;</span>
</span><span data-line="385">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;COMMIT&quot;</span><span class="p">)</span></div>

</span><span data-line="386">
<div class="viewcode-block" id="ExaConnection.rollback">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.rollback">[docs]</a>
</span><span data-line="387">    <span class="k">def</span> <span class="nf">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="388"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper for query &#39;ROLLBACK&#39;&quot;&quot;&quot;</span>
</span><span data-line="389">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;ROLLBACK&quot;</span><span class="p">)</span></div>

</span><span data-line="390">
<div class="viewcode-block" id="ExaConnection.set_autocommit">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.set_autocommit">[docs]</a>
</span><span data-line="391">    <span class="k">def</span> <span class="nf">set_autocommit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
</span><span data-line="392"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="393"><span class="sd">        Set autocommit mode.</span>
</span><span data-line="394">
</span><span data-line="395"><span class="sd">        Args:</span>
</span><span data-line="396"><span class="sd">            val:</span>
</span><span data-line="397"><span class="sd">                Set ``False`` to execute following statements in transaction.</span>
</span><span data-line="398"><span class="sd">                Set ``True`` to get back to automatic COMMIT after each statement.</span>
</span><span data-line="399">
</span><span data-line="400"><span class="sd">        Note:</span>
</span><span data-line="401"><span class="sd">            Autocommit is ``True`` by default because Exasol has to commit indexes and statistics</span>
</span><span data-line="402"><span class="sd">            objects even for pure SELECT statements. Lack of default COMMIT may lead to serious</span>
</span><span data-line="403"><span class="sd">            performance degradation.</span>
</span><span data-line="404"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="405">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span data-line="406">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Autocommit value must be boolean&quot;</span><span class="p">)</span>
</span><span data-line="407">
</span><span data-line="408">        <span class="bp">self</span><span class="o">.</span><span class="n">set_attr</span><span class="p">({</span><span class="s2">&quot;autocommit&quot;</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span></div>

</span><span data-line="409">
<div class="viewcode-block" id="ExaConnection.set_query_timeout">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.set_query_timeout">[docs]</a>
</span><span data-line="410">    <span class="k">def</span> <span class="nf">set_query_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
</span><span data-line="411"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="412"><span class="sd">        Set the maximum time in seconds for which a query can run before Exasol kills it automatically.</span>
</span><span data-line="413">
</span><span data-line="414"><span class="sd">        Args:</span>
</span><span data-line="415"><span class="sd">            val:</span>
</span><span data-line="416"><span class="sd">                Timeout value in seconds.</span>
</span><span data-line="417"><span class="sd">                Set value ``0`` to disable timeout.</span>
</span><span data-line="418">
</span><span data-line="419"><span class="sd">        Note:</span>
</span><span data-line="420"><span class="sd">            It is highly recommended to set timeout for UDF scripts to</span>
</span><span data-line="421"><span class="sd">            avoid potential infinite loops and very long transactions.</span>
</span><span data-line="422"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="423">        <span class="bp">self</span><span class="o">.</span><span class="n">set_attr</span><span class="p">({</span><span class="s2">&quot;queryTimeout&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)})</span></div>

</span><span data-line="424">
<div class="viewcode-block" id="ExaConnection.open_schema">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.open_schema">[docs]</a>
</span><span data-line="425">    <span class="k">def</span> <span class="nf">open_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
</span><span data-line="426"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="427"><span class="sd">        Wrapper for `OPEN SCHEMA`</span>
</span><span data-line="428">
</span><span data-line="429"><span class="sd">        Args:</span>
</span><span data-line="430"><span class="sd">            schema: Schema name</span>
</span><span data-line="431"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="432">        <span class="bp">self</span><span class="o">.</span><span class="n">set_attr</span><span class="p">({</span><span class="s2">&quot;currentSchema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">default_format_ident_value</span><span class="p">(</span><span class="n">schema</span><span class="p">)})</span></div>

</span><span data-line="433">
<div class="viewcode-block" id="ExaConnection.current_schema">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.current_schema">[docs]</a>
</span><span data-line="434">    <span class="k">def</span> <span class="nf">current_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="435"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="436"><span class="sd">        Get the name of the current schema.</span>
</span><span data-line="437">
</span><span data-line="438"><span class="sd">        Returns:</span>
</span><span data-line="439"><span class="sd">            Name of currently opened schema. Returns an empty string if no schema was opened.</span>
</span><span data-line="440"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="441">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;currentSchema&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>

</span><span data-line="442">
<div class="viewcode-block" id="ExaConnection.export_to_file">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.export_to_file">[docs]</a>
</span><span data-line="443">    <span class="k">def</span> <span class="nf">export_to_file</span><span class="p">(</span>
</span><span data-line="444">        <span class="bp">self</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">query_or_table</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">export_params</span><span class="o">=</span><span class="kc">None</span>
</span><span data-line="445">    <span class="p">):</span>
</span><span data-line="446"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="447"><span class="sd">        Export large amount of data from Exasol to file or file-like object using fast HTTP transport.</span>
</span><span data-line="448">
</span><span data-line="449"><span class="sd">        Note:</span>
</span><span data-line="450"><span class="sd">            File must be opened in binary mode.</span>
</span><span data-line="451">
</span><span data-line="452"><span class="sd">        Args:</span>
</span><span data-line="453"><span class="sd">            dst:</span>
</span><span data-line="454"><span class="sd">                Path to file or file-like object.</span>
</span><span data-line="455"><span class="sd">            query_or_table:</span>
</span><span data-line="456"><span class="sd">                SQL query or table for export.</span>
</span><span data-line="457"><span class="sd">            query_params:</span>
</span><span data-line="458"><span class="sd">                Values for SQL query placeholders.</span>
</span><span data-line="459"><span class="sd">            export_params:</span>
</span><span data-line="460"><span class="sd">                Custom parameters for Export query.</span>
</span><span data-line="461">
</span><span data-line="462"><span class="sd">        Examples:</span>
</span><span data-line="463"><span class="sd">            &gt;&gt;&gt; con = ExaConnection(...)</span>
</span><span data-line="464"><span class="sd">            &gt;&gt;&gt; with open(&#39;/tmp/file.csv&#39;, &#39;wb&#39;) as f:</span>
</span><span data-line="465"><span class="sd">            ...     con.export_to_file(</span>
</span><span data-line="466"><span class="sd">            ...         dst=f,</span>
</span><span data-line="467"><span class="sd">            ...         query_or_table=&quot;SELECT * FROM table&quot;</span>
</span><span data-line="468"><span class="sd">            ...     )</span>
</span><span data-line="469"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="470">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_to_callback</span><span class="p">(</span>
</span><span data-line="471">            <span class="n">cb</span><span class="o">.</span><span class="n">export_to_file</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">query_or_table</span><span class="p">,</span> <span class="n">query_params</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">export_params</span>
</span><span data-line="472">        <span class="p">)</span></div>

</span><span data-line="473">
<div class="viewcode-block" id="ExaConnection.export_to_list">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.export_to_list">[docs]</a>
</span><span data-line="474">    <span class="k">def</span> <span class="nf">export_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_or_table</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">export_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="475"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="476"><span class="sd">        Export large amount of data from Exasol to basic Python `list` using fast HTTP transport.</span>
</span><span data-line="477">
</span><span data-line="478"><span class="sd">        Args:</span>
</span><span data-line="479"><span class="sd">            query_or_table:</span>
</span><span data-line="480"><span class="sd">                SQL query or table for export.</span>
</span><span data-line="481"><span class="sd">            query_params:</span>
</span><span data-line="482"><span class="sd">                Values for SQL query placeholders.</span>
</span><span data-line="483"><span class="sd">            export_params:</span>
</span><span data-line="484"><span class="sd">                Custom parameters for Export query.</span>
</span><span data-line="485">
</span><span data-line="486"><span class="sd">        Returns:</span>
</span><span data-line="487"><span class="sd">            `list` of `tuples`</span>
</span><span data-line="488">
</span><span data-line="489"><span class="sd">        Warnings:</span>
</span><span data-line="490"><span class="sd">            - This function may run out of memory</span>
</span><span data-line="491">
</span><span data-line="492"><span class="sd">        Examples:</span>
</span><span data-line="493"><span class="sd">            &gt;&gt;&gt; con = ExaConnection(...)</span>
</span><span data-line="494"><span class="sd">            &gt;&gt;&gt; myresult = con.export_to_list(</span>
</span><span data-line="495"><span class="sd">            ...    query_or_table=&quot;SELECT * FROM table&quot;</span>
</span><span data-line="496"><span class="sd">            ... )</span>
</span><span data-line="497"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="498">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_to_callback</span><span class="p">(</span>
</span><span data-line="499">            <span class="n">cb</span><span class="o">.</span><span class="n">export_to_list</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query_or_table</span><span class="p">,</span> <span class="n">query_params</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">export_params</span>
</span><span data-line="500">        <span class="p">)</span></div>

</span><span data-line="501">
<div class="viewcode-block" id="ExaConnection.export_to_pandas">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.export_to_pandas">[docs]</a>
</span><span data-line="502">    <span class="k">def</span> <span class="nf">export_to_pandas</span><span class="p">(</span>
</span><span data-line="503">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="504">        <span class="n">query_or_table</span><span class="p">,</span>
</span><span data-line="505">        <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="506">        <span class="n">callback_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="507">        <span class="n">export_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="508">    <span class="p">):</span>
</span><span data-line="509"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="510"><span class="sd">        Export large amount of data from Exasol to :class:`pandas.DataFrame`.</span>
</span><span data-line="511">
</span><span data-line="512"><span class="sd">        Args:</span>
</span><span data-line="513"><span class="sd">            query_or_table:</span>
</span><span data-line="514"><span class="sd">                SQL query or table for export.</span>
</span><span data-line="515"><span class="sd">            query_params:</span>
</span><span data-line="516"><span class="sd">                Values for SQL query placeholders.</span>
</span><span data-line="517"><span class="sd">            export_params:</span>
</span><span data-line="518"><span class="sd">                Custom parameters for Export query.</span>
</span><span data-line="519">
</span><span data-line="520"><span class="sd">        Returns:</span>
</span><span data-line="521"><span class="sd">            instance of :class:`pandas.DataFrame`</span>
</span><span data-line="522">
</span><span data-line="523"><span class="sd">        Warnings:</span>
</span><span data-line="524"><span class="sd">            - This function may run out of memory</span>
</span><span data-line="525">
</span><span data-line="526"><span class="sd">        Examples:</span>
</span><span data-line="527"><span class="sd">            &gt;&gt;&gt; con = ExaConnection(...)</span>
</span><span data-line="528"><span class="sd">            &gt;&gt;&gt; myresult = con.export_to_pandas(</span>
</span><span data-line="529"><span class="sd">            ...    query_or_table=&quot;SELECT * FROM table&quot;</span>
</span><span data-line="530"><span class="sd">            ... )</span>
</span><span data-line="531"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="532">        <span class="k">if</span> <span class="ow">not</span> <span class="n">export_params</span><span class="p">:</span>
</span><span data-line="533">            <span class="n">export_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="534">
</span><span data-line="535">        <span class="n">export_params</span><span class="p">[</span><span class="s2">&quot;with_column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="536">
</span><span data-line="537">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_to_callback</span><span class="p">(</span>
</span><span data-line="538">            <span class="n">cb</span><span class="o">.</span><span class="n">export_to_pandas</span><span class="p">,</span>
</span><span data-line="539">            <span class="kc">None</span><span class="p">,</span>
</span><span data-line="540">            <span class="n">query_or_table</span><span class="p">,</span>
</span><span data-line="541">            <span class="n">query_params</span><span class="p">,</span>
</span><span data-line="542">            <span class="n">callback_params</span><span class="p">,</span>
</span><span data-line="543">            <span class="n">export_params</span><span class="p">,</span>
</span><span data-line="544">        <span class="p">)</span></div>

</span><span data-line="545">
<div class="viewcode-block" id="ExaConnection.import_from_file">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.import_from_file">[docs]</a>
</span><span data-line="546">    <span class="k">def</span> <span class="nf">import_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">import_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="547"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="548"><span class="sd">        Import a large amount of data from a file or file-like object.</span>
</span><span data-line="549">
</span><span data-line="550"><span class="sd">        Args:</span>
</span><span data-line="551"><span class="sd">            src:</span>
</span><span data-line="552"><span class="sd">                Source file or file-like object.</span>
</span><span data-line="553"><span class="sd">            table:</span>
</span><span data-line="554"><span class="sd">                Destination table for IMPORT.</span>
</span><span data-line="555"><span class="sd">            import_params:</span>
</span><span data-line="556"><span class="sd">                Custom parameters for import query.</span>
</span><span data-line="557">
</span><span data-line="558"><span class="sd">        Note:</span>
</span><span data-line="559"><span class="sd">            File must be opened in binary mode.</span>
</span><span data-line="560"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="561">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_from_callback</span><span class="p">(</span>
</span><span data-line="562">            <span class="n">cb</span><span class="o">.</span><span class="n">import_from_file</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">import_params</span>
</span><span data-line="563">        <span class="p">)</span></div>

</span><span data-line="564">
<div class="viewcode-block" id="ExaConnection.import_from_iterable">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.import_from_iterable">[docs]</a>
</span><span data-line="565">    <span class="k">def</span> <span class="nf">import_from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">import_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="566"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="567"><span class="sd">        Import a large amount of data from an ``iterable`` Python object.</span>
</span><span data-line="568">
</span><span data-line="569"><span class="sd">        Args:</span>
</span><span data-line="570"><span class="sd">            src:</span>
</span><span data-line="571"><span class="sd">                Source object implementing ``__iter__``.</span>
</span><span data-line="572"><span class="sd">                Iterator must return tuples of values.</span>
</span><span data-line="573"><span class="sd">            table:</span>
</span><span data-line="574"><span class="sd">                Destination table for IMPORT.</span>
</span><span data-line="575"><span class="sd">            import_params:</span>
</span><span data-line="576"><span class="sd">                Custom parameters for import query.</span>
</span><span data-line="577"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="578">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_from_callback</span><span class="p">(</span>
</span><span data-line="579">            <span class="n">cb</span><span class="o">.</span><span class="n">import_from_iterable</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">import_params</span>
</span><span data-line="580">        <span class="p">)</span></div>

</span><span data-line="581">
<div class="viewcode-block" id="ExaConnection.import_from_pandas">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.import_from_pandas">[docs]</a>
</span><span data-line="582">    <span class="k">def</span> <span class="nf">import_from_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">callback_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">import_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="583"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="584"><span class="sd">        Import a large amount of data from ``pandas.DataFrame``.</span>
</span><span data-line="585">
</span><span data-line="586"><span class="sd">        Args:</span>
</span><span data-line="587"><span class="sd">            src:</span>
</span><span data-line="588"><span class="sd">                Source ``pandas.DataFrame`` instance.</span>
</span><span data-line="589"><span class="sd">            table:</span>
</span><span data-line="590"><span class="sd">                Destination table for IMPORT.</span>
</span><span data-line="591"><span class="sd">            import_params:</span>
</span><span data-line="592"><span class="sd">                Custom parameters for import query.</span>
</span><span data-line="593"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="594">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_from_callback</span><span class="p">(</span>
</span><span data-line="595">            <span class="n">cb</span><span class="o">.</span><span class="n">import_from_pandas</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">callback_params</span><span class="p">,</span> <span class="n">import_params</span>
</span><span data-line="596">        <span class="p">)</span></div>

</span><span data-line="597">
<div class="viewcode-block" id="ExaConnection.export_to_callback">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.export_to_callback">[docs]</a>
</span><span data-line="598">    <span class="k">def</span> <span class="nf">export_to_callback</span><span class="p">(</span>
</span><span data-line="599">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="600">        <span class="n">callback</span><span class="p">,</span>
</span><span data-line="601">        <span class="n">dst</span><span class="p">,</span>
</span><span data-line="602">        <span class="n">query_or_table</span><span class="p">,</span>
</span><span data-line="603">        <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="604">        <span class="n">callback_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="605">        <span class="n">export_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="606">    <span class="p">):</span>
</span><span data-line="607"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="608"><span class="sd">        Export large amount of data to user-defined callback function</span>
</span><span data-line="609">
</span><span data-line="610"><span class="sd">        Args:</span>
</span><span data-line="611"><span class="sd">            callback:</span>
</span><span data-line="612"><span class="sd">                Callback function</span>
</span><span data-line="613"><span class="sd">            query_or_table:</span>
</span><span data-line="614"><span class="sd">                SQL query or table for export.</span>
</span><span data-line="615"><span class="sd">            query_params:</span>
</span><span data-line="616"><span class="sd">                Values for SQL query placeholders.</span>
</span><span data-line="617"><span class="sd">            export_params:</span>
</span><span data-line="618"><span class="sd">                Custom parameters for Export query.</span>
</span><span data-line="619">
</span><span data-line="620"><span class="sd">        Returns:</span>
</span><span data-line="621"><span class="sd">            result of callback function</span>
</span><span data-line="622">
</span><span data-line="623"><span class="sd">        Warnings:</span>
</span><span data-line="624"><span class="sd">            - This function may run out of memory</span>
</span><span data-line="625">
</span><span data-line="626"><span class="sd">        Examples:</span>
</span><span data-line="627"><span class="sd">            &gt;&gt;&gt; cb = lamda args: print(args)</span>
</span><span data-line="628"><span class="sd">            &gt;&gt;&gt; con = ExaConnection(...)</span>
</span><span data-line="629"><span class="sd">            &gt;&gt;&gt; con.export_to_callback(</span>
</span><span data-line="630"><span class="sd">            ...    callback=cb,</span>
</span><span data-line="631"><span class="sd">            ...    query_or_table=&quot;SELECT * FROM table&quot;</span>
</span><span data-line="632"><span class="sd">            ... )</span>
</span><span data-line="633"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="634">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
</span><span data-line="635">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Callback argument is not callable&quot;</span><span class="p">)</span>
</span><span data-line="636">
</span><span data-line="637">        <span class="k">if</span> <span class="n">callback_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="638">            <span class="n">callback_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="639">
</span><span data-line="640">        <span class="k">if</span> <span class="n">export_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="641">            <span class="n">export_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="642">
</span><span data-line="643">        <span class="k">if</span> <span class="n">query_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="644">            <span class="n">query_or_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query_or_table</span><span class="p">,</span> <span class="o">**</span><span class="n">query_params</span><span class="p">)</span>
</span><span data-line="645">
</span><span data-line="646">        <span class="n">compression</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="647">            <span class="kc">False</span> <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;format&quot;</span> <span class="ow">in</span> <span class="n">export_params</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span>
</span><span data-line="648">        <span class="p">)</span>
</span><span data-line="649">
</span><span data-line="650">        <span class="n">http_thread</span> <span class="o">=</span> <span class="n">ExaHttpThread</span><span class="p">(</span>
</span><span data-line="651">            <span class="bp">self</span><span class="o">.</span><span class="n">ws_ipaddr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_port</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;encryption&quot;</span><span class="p">]</span>
</span><span data-line="652">        <span class="p">)</span>
</span><span data-line="653">        <span class="n">sql_thread</span> <span class="o">=</span> <span class="n">ExaSQLExportThread</span><span class="p">(</span>
</span><span data-line="654">            <span class="bp">self</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="n">query_or_table</span><span class="p">,</span> <span class="n">export_params</span>
</span><span data-line="655">        <span class="p">)</span>
</span><span data-line="656">
</span><span data-line="657">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="658">            <span class="n">http_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span data-line="659">
</span><span data-line="660">            <span class="n">sql_thread</span><span class="o">.</span><span class="n">set_http_thread</span><span class="p">(</span><span class="n">http_thread</span><span class="p">)</span>
</span><span data-line="661">            <span class="n">sql_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span data-line="662">
</span><span data-line="663">            <span class="k">with</span> <span class="n">http_thread</span><span class="o">.</span><span class="n">read_pipe</span> <span class="k">as</span> <span class="n">pipe</span><span class="p">:</span>
</span><span data-line="664">                <span class="n">result</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="o">**</span><span class="n">callback_params</span><span class="p">)</span>
</span><span data-line="665">
</span><span data-line="666">            <span class="n">http_thread</span><span class="o">.</span><span class="n">join_with_exc</span><span class="p">()</span>
</span><span data-line="667">            <span class="n">sql_thread</span><span class="o">.</span><span class="n">join_with_exc</span><span class="p">()</span>
</span><span data-line="668">
</span><span data-line="669">            <span class="k">return</span> <span class="n">result</span>
</span><span data-line="670">
</span><span data-line="671">        <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="672">            <span class="n">http_thread</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span data-line="673">            <span class="n">http_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span data-line="674">
</span><span data-line="675">            <span class="n">sql_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="676">
</span><span data-line="677">            <span class="c1"># Prevent infinite lock if SQL query is still running</span>
</span><span data-line="678">            <span class="k">if</span> <span class="n">sql_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
</span><span data-line="679">                <span class="bp">self</span><span class="o">.</span><span class="n">abort_query</span><span class="p">()</span>
</span><span data-line="680">                <span class="n">sql_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span data-line="681">
</span><span data-line="682">            <span class="c1"># Give SQL exception higher priority</span>
</span><span data-line="683">            <span class="k">if</span> <span class="n">sql_thread</span><span class="o">.</span><span class="n">exc</span><span class="p">:</span>
</span><span data-line="684">                <span class="k">raise</span> <span class="n">sql_thread</span><span class="o">.</span><span class="n">exc</span>
</span><span data-line="685">
</span><span data-line="686">            <span class="k">raise</span> <span class="n">e</span></div>

</span><span data-line="687">
<div class="viewcode-block" id="ExaConnection.import_from_callback">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.import_from_callback">[docs]</a>
</span><span data-line="688">    <span class="k">def</span> <span class="nf">import_from_callback</span><span class="p">(</span>
</span><span data-line="689">        <span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">callback_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">import_params</span><span class="o">=</span><span class="kc">None</span>
</span><span data-line="690">    <span class="p">):</span>
</span><span data-line="691"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="692"><span class="sd">        Import a large amount of data from a user-defined callback function.</span>
</span><span data-line="693">
</span><span data-line="694"><span class="sd">        Args:</span>
</span><span data-line="695"><span class="sd">            callback:</span>
</span><span data-line="696"><span class="sd">                Callback function.</span>
</span><span data-line="697"><span class="sd">            src:</span>
</span><span data-line="698"><span class="sd">                Source for the callback function.</span>
</span><span data-line="699"><span class="sd">            table:</span>
</span><span data-line="700"><span class="sd">                Destination table for IMPORT.</span>
</span><span data-line="701"><span class="sd">            callback_params:</span>
</span><span data-line="702"><span class="sd">                Dict with additional parameters for callback function</span>
</span><span data-line="703"><span class="sd">            import_params:</span>
</span><span data-line="704"><span class="sd">                Custom parameters for IMPORT query.</span>
</span><span data-line="705">
</span><span data-line="706"><span class="sd">        Raises:</span>
</span><span data-line="707"><span class="sd">            ValueError: callback argument isn&#39;t callable.</span>
</span><span data-line="708"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="709">        <span class="k">if</span> <span class="n">callback_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="710">            <span class="n">callback_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="711">
</span><span data-line="712">        <span class="k">if</span> <span class="n">import_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="713">            <span class="n">import_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="714">
</span><span data-line="715">        <span class="n">compression</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="716">            <span class="kc">False</span> <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;format&quot;</span> <span class="ow">in</span> <span class="n">import_params</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span>
</span><span data-line="717">        <span class="p">)</span>
</span><span data-line="718">
</span><span data-line="719">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
</span><span data-line="720">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Callback argument is not callable&quot;</span><span class="p">)</span>
</span><span data-line="721">
</span><span data-line="722">        <span class="n">http_thread</span> <span class="o">=</span> <span class="n">ExaHttpThread</span><span class="p">(</span>
</span><span data-line="723">            <span class="bp">self</span><span class="o">.</span><span class="n">ws_ipaddr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_port</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;encryption&quot;</span><span class="p">]</span>
</span><span data-line="724">        <span class="p">)</span>
</span><span data-line="725">        <span class="n">sql_thread</span> <span class="o">=</span> <span class="n">ExaSQLImportThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">import_params</span><span class="p">)</span>
</span><span data-line="726">
</span><span data-line="727">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="728">            <span class="n">http_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span data-line="729">
</span><span data-line="730">            <span class="n">sql_thread</span><span class="o">.</span><span class="n">set_http_thread</span><span class="p">(</span><span class="n">http_thread</span><span class="p">)</span>
</span><span data-line="731">            <span class="n">sql_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span data-line="732">
</span><span data-line="733">            <span class="k">with</span> <span class="n">http_thread</span><span class="o">.</span><span class="n">write_pipe</span> <span class="k">as</span> <span class="n">pipe</span><span class="p">:</span>
</span><span data-line="734">                <span class="n">result</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="o">**</span><span class="n">callback_params</span><span class="p">)</span>
</span><span data-line="735">
</span><span data-line="736">            <span class="n">http_thread</span><span class="o">.</span><span class="n">join_with_exc</span><span class="p">()</span>
</span><span data-line="737">            <span class="n">sql_thread</span><span class="o">.</span><span class="n">join_with_exc</span><span class="p">()</span>
</span><span data-line="738">
</span><span data-line="739">            <span class="k">return</span> <span class="n">result</span>
</span><span data-line="740">
</span><span data-line="741">        <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="742">            <span class="n">http_thread</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span data-line="743">            <span class="n">http_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span data-line="744">
</span><span data-line="745">            <span class="n">sql_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="746">
</span><span data-line="747">            <span class="c1"># Prevent infinite lock if SQL query is still running</span>
</span><span data-line="748">            <span class="k">if</span> <span class="n">sql_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
</span><span data-line="749">                <span class="bp">self</span><span class="o">.</span><span class="n">abort_query</span><span class="p">()</span>
</span><span data-line="750">                <span class="n">sql_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span data-line="751">
</span><span data-line="752">            <span class="c1"># Give SQL exception higher priority</span>
</span><span data-line="753">            <span class="k">if</span> <span class="n">sql_thread</span><span class="o">.</span><span class="n">exc</span><span class="p">:</span>
</span><span data-line="754">                <span class="k">raise</span> <span class="n">sql_thread</span><span class="o">.</span><span class="n">exc</span>
</span><span data-line="755">
</span><span data-line="756">            <span class="k">raise</span> <span class="n">e</span></div>

</span><span data-line="757">
<div class="viewcode-block" id="ExaConnection.export_parallel">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.export_parallel">[docs]</a>
</span><span data-line="758">    <span class="k">def</span> <span class="nf">export_parallel</span><span class="p">(</span>
</span><span data-line="759">        <span class="bp">self</span><span class="p">,</span> <span class="n">exa_address_list</span><span class="p">,</span> <span class="n">query_or_table</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">export_params</span><span class="o">=</span><span class="kc">None</span>
</span><span data-line="760">    <span class="p">):</span>
</span><span data-line="761"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="762"><span class="sd">        This function is part of :ref:`http_transport_parallel` API.</span>
</span><span data-line="763">
</span><span data-line="764"><span class="sd">        Args:</span>
</span><span data-line="765"><span class="sd">            exa_address_list:</span>
</span><span data-line="766"><span class="sd">                List of ``ipaddr:port`` strings obtained from HTTP transport ``.address``.</span>
</span><span data-line="767"><span class="sd">            query_or_table:</span>
</span><span data-line="768"><span class="sd">                SQL query or table for the export.</span>
</span><span data-line="769"><span class="sd">            query_params:</span>
</span><span data-line="770"><span class="sd">                Values for SQL query placeholders.</span>
</span><span data-line="771"><span class="sd">            export_params:</span>
</span><span data-line="772"><span class="sd">                Custom parameters for Export query.</span>
</span><span data-line="773"><span class="sd">        Note:</span>
</span><span data-line="774"><span class="sd">            - Init HTTP transport in child processes first using pyexasol.http_transport()</span>
</span><span data-line="775"><span class="sd">            - Get internal Exasol address from each child process using .address</span>
</span><span data-line="776"><span class="sd">            - Pass address strings to parent process, combine into single list and use it for export_parallel() call</span>
</span><span data-line="777"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="778">        <span class="k">if</span> <span class="n">export_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="779">            <span class="n">export_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="780">
</span><span data-line="781">        <span class="n">compression</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="782">            <span class="kc">False</span> <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;format&quot;</span> <span class="ow">in</span> <span class="n">export_params</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span>
</span><span data-line="783">        <span class="p">)</span>
</span><span data-line="784">
</span><span data-line="785">        <span class="k">if</span> <span class="n">query_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="786">            <span class="n">query_or_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query_or_table</span><span class="p">,</span> <span class="o">**</span><span class="n">query_params</span><span class="p">)</span>
</span><span data-line="787">
</span><span data-line="788">        <span class="c1"># There is no need to actually run a separate thread here, all work is performed in separate processes</span>
</span><span data-line="789">        <span class="c1"># We simply reuse thread class to keep logic in one place</span>
</span><span data-line="790">        <span class="n">sql_thread</span> <span class="o">=</span> <span class="n">ExaSQLExportThread</span><span class="p">(</span>
</span><span data-line="791">            <span class="bp">self</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="n">query_or_table</span><span class="p">,</span> <span class="n">export_params</span>
</span><span data-line="792">        <span class="p">)</span>
</span><span data-line="793">        <span class="n">sql_thread</span><span class="o">.</span><span class="n">set_exa_address_list</span><span class="p">(</span><span class="n">exa_address_list</span><span class="p">)</span>
</span><span data-line="794">        <span class="n">sql_thread</span><span class="o">.</span><span class="n">run_sql</span><span class="p">()</span></div>

</span><span data-line="795">
<div class="viewcode-block" id="ExaConnection.import_parallel">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.import_parallel">[docs]</a>
</span><span data-line="796">    <span class="k">def</span> <span class="nf">import_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exa_address_list</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">import_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="797"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="798"><span class="sd">        This function is part of :ref:`http_transport_parallel` API.</span>
</span><span data-line="799">
</span><span data-line="800"><span class="sd">        Args:</span>
</span><span data-line="801"><span class="sd">            exa_address_list:</span>
</span><span data-line="802"><span class="sd">                List of ``ipaddr:port`` strings obtained from HTTP transport ``.address``.</span>
</span><span data-line="803"><span class="sd">            table:</span>
</span><span data-line="804"><span class="sd">                Table to import to.</span>
</span><span data-line="805"><span class="sd">            import_params:</span>
</span><span data-line="806"><span class="sd">                Custom parameters for import.</span>
</span><span data-line="807">
</span><span data-line="808"><span class="sd">        Note:</span>
</span><span data-line="809"><span class="sd">            - Init HTTP transport in child processes first using pyexasol.http_transport()</span>
</span><span data-line="810"><span class="sd">            - Get internal Exasol address from each child process using .address</span>
</span><span data-line="811"><span class="sd">            - Pass address strings to parent process, combine into single list and use it for import_parallel() call</span>
</span><span data-line="812">
</span><span data-line="813"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="814">        <span class="k">if</span> <span class="n">import_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="815">            <span class="n">import_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="816">
</span><span data-line="817">        <span class="n">compression</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="818">            <span class="kc">False</span> <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;format&quot;</span> <span class="ow">in</span> <span class="n">import_params</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span>
</span><span data-line="819">        <span class="p">)</span>
</span><span data-line="820">
</span><span data-line="821">        <span class="c1"># There is no need to actually run a separate thread here, all work is performed in separate processes</span>
</span><span data-line="822">        <span class="c1"># We simply reuse thread class to keep logic in one place</span>
</span><span data-line="823">        <span class="n">sql_thread</span> <span class="o">=</span> <span class="n">ExaSQLImportThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">import_params</span><span class="p">)</span>
</span><span data-line="824">        <span class="n">sql_thread</span><span class="o">.</span><span class="n">set_exa_address_list</span><span class="p">(</span><span class="n">exa_address_list</span><span class="p">)</span>
</span><span data-line="825">        <span class="n">sql_thread</span><span class="o">.</span><span class="n">run_sql</span><span class="p">()</span></div>

</span><span data-line="826">
<div class="viewcode-block" id="ExaConnection.session_id">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.session_id">[docs]</a>
</span><span data-line="827">    <span class="k">def</span> <span class="nf">session_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="828"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="829"><span class="sd">        Session id of current session.</span>
</span><span data-line="830">
</span><span data-line="831"><span class="sd">        Returns:</span>
</span><span data-line="832"><span class="sd">            Unique `SESSION_ID` of the current session as string.</span>
</span><span data-line="833"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="834">        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">login_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sessionId&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span></div>

</span><span data-line="835">
<div class="viewcode-block" id="ExaConnection.protocol_version">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.protocol_version">[docs]</a>
</span><span data-line="836">    <span class="k">def</span> <span class="nf">protocol_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="837"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="838"><span class="sd">        Actual protocol version used by the the established connection.</span>
</span><span data-line="839">
</span><span data-line="840"><span class="sd">        Returns:</span>
</span><span data-line="841"><span class="sd">            ``0`` if connection was not established yet (e.g. due to exception handling), otherwise protocol version as int.</span>
</span><span data-line="842">
</span><span data-line="843"><span class="sd">        Warnings:</span>
</span><span data-line="844"><span class="sd">            Actual Protocol version might be downgraded from requested protocol version if Exasol server does not support it</span>
</span><span data-line="845">
</span><span data-line="846"><span class="sd">        Note:</span>
</span><span data-line="847"><span class="sd">            The actual protocol version may be lower than the requested protocol version</span>
</span><span data-line="848"><span class="sd">            defined by the ``protocol_version`` connection option. For further details,</span>
</span><span data-line="849"><span class="sd">            refer to :ref:`protocol_version`.</span>
</span><span data-line="850">
</span><span data-line="851"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="852">        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">login_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocolVersion&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>

</span><span data-line="853">
<div class="viewcode-block" id="ExaConnection.last_statement">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.last_statement">[docs]</a>
</span><span data-line="854">    <span class="k">def</span> <span class="nf">last_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExaStatement</span><span class="p">:</span>
</span><span data-line="855"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="856"><span class="sd">        Last created statement object</span>
</span><span data-line="857">
</span><span data-line="858"><span class="sd">        Returns:</span>
</span><span data-line="859"><span class="sd">            ExaStatement: last created statement.</span>
</span><span data-line="860">
</span><span data-line="861"><span class="sd">        Note:</span>
</span><span data-line="862"><span class="sd">            It is mainly used for HTTP transport to access internal IMPORT / EXPORT query,</span>
</span><span data-line="863"><span class="sd">            measure execution time and number of rows</span>
</span><span data-line="864">
</span><span data-line="865"><span class="sd">        Tip:</span>
</span><span data-line="866"><span class="sd">            It is useful while working with `export_*` and `import_*` functions normally</span>
</span><span data-line="867"><span class="sd">            returning result of callback function instead of statement object.</span>
</span><span data-line="868"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="869">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_stmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="870">            <span class="k">raise</span> <span class="n">ExaRuntimeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Last statement not found&quot;</span><span class="p">)</span>
</span><span data-line="871">
</span><span data-line="872">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_stmt</span></div>

</span><span data-line="873">
<div class="viewcode-block" id="ExaConnection.close">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.close">[docs]</a>
</span><span data-line="874">    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disconnect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span data-line="875"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="876"><span class="sd">        Closes connection to database.</span>
</span><span data-line="877">
</span><span data-line="878"><span class="sd">        Args:</span>
</span><span data-line="879"><span class="sd">            disconnect:</span>
</span><span data-line="880"><span class="sd">                If ``true`` send optional &quot;disconnect&quot; command to free resources and close session on Exasol server side properly.</span>
</span><span data-line="881">
</span><span data-line="882"><span class="sd">        Note:</span>
</span><span data-line="883"><span class="sd">            Please note that &quot;disconnect&quot; should always be False when .close() is being called from .req()-like functions</span>
</span><span data-line="884"><span class="sd">            to prevent an infinite loop if websocket exception happens during handling of &quot;disconnect&quot; command</span>
</span><span data-line="885"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="886">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span data-line="887">            <span class="k">if</span> <span class="n">disconnect</span><span class="p">:</span>
</span><span data-line="888">                <span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">({</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;disconnect&quot;</span><span class="p">})</span>
</span><span data-line="889">
</span><span data-line="890">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[WebSocket connection close]&quot;</span><span class="p">)</span>
</span><span data-line="891">            <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span data-line="892">
</span><span data-line="893">        <span class="bp">self</span><span class="o">.</span><span class="n">is_closed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="894">        <span class="bp">self</span><span class="o">.</span><span class="n">last_stmt</span> <span class="o">=</span> <span class="kc">None</span></div>

</span><span data-line="895">
<div class="viewcode-block" id="ExaConnection.get_attr">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.get_attr">[docs]</a>
</span><span data-line="896">    <span class="k">def</span> <span class="nf">get_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="897">        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">(</span>
</span><span data-line="898">            <span class="p">{</span>
</span><span data-line="899">                <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;getAttributes&quot;</span><span class="p">,</span>
</span><span data-line="900">            <span class="p">}</span>
</span><span data-line="901">        <span class="p">)</span>
</span><span data-line="902">
</span><span data-line="903">        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span></div>

</span><span data-line="904">
<div class="viewcode-block" id="ExaConnection.set_attr">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.set_attr">[docs]</a>
</span><span data-line="905">    <span class="k">def</span> <span class="nf">set_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_attr</span><span class="p">):</span>
</span><span data-line="906">        <span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">(</span>
</span><span data-line="907">            <span class="p">{</span>
</span><span data-line="908">                <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;setAttributes&quot;</span><span class="p">,</span>
</span><span data-line="909">                <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="n">new_attr</span><span class="p">,</span>
</span><span data-line="910">            <span class="p">}</span>
</span><span data-line="911">        <span class="p">)</span>
</span><span data-line="912">
</span><span data-line="913">        <span class="c1"># At this moment setAttributes response is inconsistent, so attributes must be refreshed after every call</span>
</span><span data-line="914">        <span class="bp">self</span><span class="o">.</span><span class="n">get_attr</span><span class="p">()</span></div>

</span><span data-line="915">
<div class="viewcode-block" id="ExaConnection.get_nodes">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.get_nodes">[docs]</a>
</span><span data-line="916">    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="917"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="918"><span class="sd">        List of currently active Exasol nodes which is normally used for :ref:`http_transport_parallel`.</span>
</span><span data-line="919">
</span><span data-line="920"><span class="sd">        Args:</span>
</span><span data-line="921"><span class="sd">            pool_size:</span>
</span><span data-line="922"><span class="sd">                Return list of specific size.</span>
</span><span data-line="923">
</span><span data-line="924"><span class="sd">        Returns:</span>
</span><span data-line="925"><span class="sd">            list of dictionaries describing active Exasol nodes</span>
</span><span data-line="926">
</span><span data-line="927"><span class="sd">        Note:</span>
</span><span data-line="928">
</span><span data-line="929"><span class="sd">            Format: ``{&#39;ipaddr&#39;: &lt;ip_address&gt;, &#39;port&#39;: &lt;port&gt;, &#39;idx&#39;: &lt;incremental index of returned node&gt;}``</span>
</span><span data-line="930">
</span><span data-line="931"><span class="sd">            - If pool_size is bigger than number of nodes, list will wrap around and nodes will repeat with different &#39;idx&#39;</span>
</span><span data-line="932"><span class="sd">            - If pool_size is omitted, return every active node once</span>
</span><span data-line="933"><span class="sd">            - It is useful to balance workload for parallel IMPORT and EXPORT Exasol shuffles list for every connection</span>
</span><span data-line="934"><span class="sd">            - Exasol shuffles list for every connection.</span>
</span><span data-line="935"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="936">        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">(</span>
</span><span data-line="937">            <span class="p">{</span>
</span><span data-line="938">                <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;getHosts&quot;</span><span class="p">,</span>
</span><span data-line="939">                <span class="s2">&quot;hostIp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_ipaddr</span><span class="p">,</span>
</span><span data-line="940">            <span class="p">}</span>
</span><span data-line="941">        <span class="p">)</span>
</span><span data-line="942">
</span><span data-line="943">        <span class="k">if</span> <span class="n">pool_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="944">            <span class="n">pool_size</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;responseData&quot;</span><span class="p">][</span><span class="s2">&quot;numNodes&quot;</span><span class="p">]</span>
</span><span data-line="945">
</span><span data-line="946">        <span class="c1"># Key &#39;host&#39; is deprecated and remains only for backwards compatibility, please use `ipaddr` instead</span>
</span><span data-line="947">        <span class="k">return</span> <span class="p">[</span>
</span><span data-line="948">            <span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">ipaddr</span><span class="p">,</span> <span class="s2">&quot;ipaddr&quot;</span><span class="p">:</span> <span class="n">ipaddr</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_port</span><span class="p">,</span> <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="n">idx</span><span class="p">}</span>
</span><span data-line="949">            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ipaddr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span data-line="950">                <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span>
</span><span data-line="951">                    <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="s2">&quot;responseData&quot;</span><span class="p">][</span><span class="s2">&quot;nodes&quot;</span><span class="p">]),</span> <span class="n">pool_size</span>
</span><span data-line="952">                <span class="p">),</span>
</span><span data-line="953">                <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span data-line="954">            <span class="p">)</span>
</span><span data-line="955">        <span class="p">]</span></div>

</span><span data-line="956">
<div class="viewcode-block" id="ExaConnection.req">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.req">[docs]</a>
</span><span data-line="957">    <span class="k">def</span> <span class="nf">req</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
</span><span data-line="958"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Send WebSocket request and wait for response&quot;&quot;&quot;</span>
</span><span data-line="959">        <span class="bp">self</span><span class="o">.</span><span class="n">ws_req_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span data-line="960">        <span class="n">local_req_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_req_count</span>
</span><span data-line="961">
</span><span data-line="962">        <span class="c1"># Build request</span>
</span><span data-line="963">        <span class="n">send_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_encode</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</span><span data-line="964">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug_json</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WebSocket request #</span><span class="si">{</span><span class="n">local_req_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
</span><span data-line="965">
</span><span data-line="966">        <span class="c1"># Prevent and discourage attempts to use connection object from another thread simultaneously</span>
</span><span data-line="967">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_req_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span data-line="968">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WebSocket request #</span><span class="si">{</span><span class="n">local_req_count</span><span class="si">}</span><span class="s2"> WAS NOT SENT]&quot;</span><span class="p">)</span>
</span><span data-line="969">            <span class="k">raise</span> <span class="n">ExaConcurrencyError</span><span class="p">(</span>
</span><span data-line="970">                <span class="bp">self</span><span class="p">,</span>
</span><span data-line="971">                <span class="s2">&quot;Connection cannot be shared between multiple threads &quot;</span>
</span><span data-line="972">                <span class="s2">&quot;sending requests simultaneously&quot;</span><span class="p">,</span>
</span><span data-line="973">            <span class="p">)</span>
</span><span data-line="974">
</span><span data-line="975">        <span class="c1"># Send request, wait for response</span>
</span><span data-line="976">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="977">            <span class="n">start_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span data-line="978">
</span><span data-line="979">            <span class="bp">self</span><span class="o">.</span><span class="n">_ws_send</span><span class="p">(</span><span class="n">send_data</span><span class="p">)</span>
</span><span data-line="980">            <span class="n">recv_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ws_recv</span><span class="p">()</span>
</span><span data-line="981">
</span><span data-line="982">            <span class="bp">self</span><span class="o">.</span><span class="n">ws_req_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span>
</span><span data-line="983">        <span class="k">except</span> <span class="p">(</span><span class="n">websocket</span><span class="o">.</span><span class="n">WebSocketException</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="984">            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">disconnect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="985">            <span class="k">raise</span> <span class="n">ExaCommunicationError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span data-line="986">        <span class="k">finally</span><span class="p">:</span>
</span><span data-line="987">            <span class="bp">self</span><span class="o">.</span><span class="n">_req_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span data-line="988">
</span><span data-line="989">        <span class="k">if</span> <span class="ow">not</span> <span class="n">recv_data</span><span class="p">:</span>
</span><span data-line="990">            <span class="k">raise</span> <span class="n">ExaCommunicationError</span><span class="p">(</span>
</span><span data-line="991">                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Empty WebSocket response, connection was likely closed&quot;</span>
</span><span data-line="992">            <span class="p">)</span>
</span><span data-line="993">
</span><span data-line="994">        <span class="c1"># Parse response</span>
</span><span data-line="995">        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_decode</span><span class="p">(</span><span class="n">recv_data</span><span class="p">)</span>
</span><span data-line="996">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug_json</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WebSocket response #</span><span class="si">{</span><span class="n">local_req_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
</span><span data-line="997">
</span><span data-line="998">        <span class="c1"># Updated attributes may be returned from any request</span>
</span><span data-line="999">        <span class="k">if</span> <span class="s2">&quot;attributes&quot;</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
</span><span data-line="1000">            <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="o">**</span><span class="n">ret</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]}</span>
</span><span data-line="1001">
</span><span data-line="1002">        <span class="k">if</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
</span><span data-line="1003">            <span class="k">return</span> <span class="n">ret</span>
</span><span data-line="1004">
</span><span data-line="1005">        <span class="k">if</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
</span><span data-line="1006">            <span class="c1"># Special treatment for &quot;execute&quot; command to prevent very long tracebacks in most common cases</span>
</span><span data-line="1007">            <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;execute&quot;</span><span class="p">,</span> <span class="s2">&quot;createPreparedStatement&quot;</span><span class="p">]:</span>
</span><span data-line="1008">                <span class="k">if</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">][</span><span class="s2">&quot;sqlCode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;R0001&quot;</span><span class="p">:</span>
</span><span data-line="1009">                    <span class="n">cls_err</span> <span class="o">=</span> <span class="n">ExaQueryTimeoutError</span>
</span><span data-line="1010">                <span class="k">elif</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">][</span><span class="s2">&quot;sqlCode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;R0003&quot;</span><span class="p">:</span>
</span><span data-line="1011">                    <span class="n">cls_err</span> <span class="o">=</span> <span class="n">ExaQueryAbortError</span>
</span><span data-line="1012">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="1013">                    <span class="n">cls_err</span> <span class="o">=</span> <span class="n">ExaQueryError</span>
</span><span data-line="1014">
</span><span data-line="1015">                <span class="k">raise</span> <span class="n">cls_err</span><span class="p">(</span>
</span><span data-line="1016">                    <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1017">                    <span class="n">req</span><span class="p">[</span><span class="s2">&quot;sqlText&quot;</span><span class="p">],</span>
</span><span data-line="1018">                    <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">][</span><span class="s2">&quot;sqlCode&quot;</span><span class="p">],</span>
</span><span data-line="1019">                    <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">],</span>
</span><span data-line="1020">                <span class="p">)</span>
</span><span data-line="1021">            <span class="k">elif</span> <span class="n">req</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1022">                <span class="k">raise</span> <span class="n">ExaAuthError</span><span class="p">(</span>
</span><span data-line="1023">                    <span class="bp">self</span><span class="p">,</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">][</span><span class="s2">&quot;sqlCode&quot;</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
</span><span data-line="1024">                <span class="p">)</span>
</span><span data-line="1025">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1026">                <span class="k">raise</span> <span class="n">ExaRequestError</span><span class="p">(</span>
</span><span data-line="1027">                    <span class="bp">self</span><span class="p">,</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">][</span><span class="s2">&quot;sqlCode&quot;</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
</span><span data-line="1028">                <span class="p">)</span></div>

</span><span data-line="1029">
<div class="viewcode-block" id="ExaConnection.abort_query">
<a class="viewcode-back" href="../../api.html#pyexasol.ExaConnection.abort_query">[docs]</a>
</span><span data-line="1030">    <span class="k">def</span> <span class="nf">abort_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1031"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1032"><span class="sd">        Abort running query</span>
</span><span data-line="1033">
</span><span data-line="1034"><span class="sd">        Warnings:</span>
</span><span data-line="1035">
</span><span data-line="1036"><span class="sd">            This function should be called from a separate thread and has no response</span>
</span><span data-line="1037"><span class="sd">            Response should be checked in the main thread which started execution of query</span>
</span><span data-line="1038">
</span><span data-line="1039"><span class="sd">            There are three possible outcomes of calling this function:</span>
</span><span data-line="1040">
</span><span data-line="1041"><span class="sd">            #. Query is aborted normally, connection remains active</span>
</span><span data-line="1042"><span class="sd">            #. Query was stuck in a state which cannot be aborted, so Exasol has to terminate connection</span>
</span><span data-line="1043"><span class="sd">            #. Query might be finished successfully before abort call had a chance to take effect</span>
</span><span data-line="1044"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1045">        <span class="n">req</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;abortQuery&quot;</span><span class="p">}</span>
</span><span data-line="1046">
</span><span data-line="1047">        <span class="n">send_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_encode</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</span><span data-line="1048">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug_json</span><span class="p">(</span><span class="s2">&quot;WebSocket abort request&quot;</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
</span><span data-line="1049">
</span><span data-line="1050">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1051">            <span class="bp">self</span><span class="o">.</span><span class="n">_ws_send</span><span class="p">(</span><span class="n">send_data</span><span class="p">)</span>
</span><span data-line="1052">        <span class="k">except</span> <span class="p">(</span><span class="n">websocket</span><span class="o">.</span><span class="n">WebSocketException</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="1053">            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">disconnect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="1054">            <span class="k">raise</span> <span class="n">ExaCommunicationError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

</span><span data-line="1055">
</span><span data-line="1056">    <span class="k">def</span> <span class="nf">_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1057">        <span class="n">start_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span data-line="1058">
</span><span data-line="1059">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">]:</span>
</span><span data-line="1060">            <span class="n">auth_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_login_token</span><span class="p">()</span>
</span><span data-line="1061">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1062">            <span class="n">auth_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_login_password</span><span class="p">()</span>
</span><span data-line="1063">
</span><span data-line="1064">        <span class="bp">self</span><span class="o">.</span><span class="n">login_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">(</span>
</span><span data-line="1065">            <span class="p">{</span>
</span><span data-line="1066">                <span class="o">**</span><span class="n">auth_params</span><span class="p">,</span>
</span><span data-line="1067">                <span class="s2">&quot;driverName&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constant</span><span class="o">.</span><span class="n">DRIVER_NAME</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span data-line="1068">                <span class="s2">&quot;clientName&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span data-line="1069">                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;client_name&quot;</span><span class="p">]</span>
</span><span data-line="1070">                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;client_name&quot;</span><span class="p">]</span>
</span><span data-line="1071">                    <span class="k">else</span> <span class="n">constant</span><span class="o">.</span><span class="n">DRIVER_NAME</span>
</span><span data-line="1072">                <span class="p">),</span>
</span><span data-line="1073">                <span class="s2">&quot;clientVersion&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span data-line="1074">                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;client_version&quot;</span><span class="p">]</span>
</span><span data-line="1075">                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;client_version&quot;</span><span class="p">]</span>
</span><span data-line="1076">                    <span class="k">else</span> <span class="n">__version__</span>
</span><span data-line="1077">                <span class="p">),</span>
</span><span data-line="1078">                <span class="s2">&quot;clientOs&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">platform</span><span class="p">(),</span>
</span><span data-line="1079">                <span class="s2">&quot;clientOsUsername&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span data-line="1080">                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;client_os_username&quot;</span><span class="p">]</span>
</span><span data-line="1081">                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;client_os_username&quot;</span><span class="p">]</span>
</span><span data-line="1082">                    <span class="k">else</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>
</span><span data-line="1083">                <span class="p">),</span>
</span><span data-line="1084">                <span class="s2">&quot;clientRuntime&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Python </span><span class="si">{</span><span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span data-line="1085">                <span class="s2">&quot;useCompression&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">],</span>
</span><span data-line="1086">                <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_login_attributes</span><span class="p">(),</span>
</span><span data-line="1087">            <span class="p">}</span>
</span><span data-line="1088">        <span class="p">)[</span><span class="s2">&quot;responseData&quot;</span><span class="p">]</span>
</span><span data-line="1089">
</span><span data-line="1090">        <span class="bp">self</span><span class="o">.</span><span class="n">login_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span>
</span><span data-line="1091">
</span><span data-line="1092">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]:</span>
</span><span data-line="1093">            <span class="bp">self</span><span class="o">.</span><span class="n">_ws_send</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">send_binary</span><span class="p">(</span>
</span><span data-line="1094">                <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span data-line="1095">            <span class="p">)</span>
</span><span data-line="1096">            <span class="bp">self</span><span class="o">.</span><span class="n">_ws_recv</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
</span><span data-line="1097">
</span><span data-line="1098">    <span class="k">def</span> <span class="nf">_login_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1099">        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">(</span>
</span><span data-line="1100">            <span class="p">{</span>
</span><span data-line="1101">                <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;login&quot;</span><span class="p">,</span>
</span><span data-line="1102">                <span class="s2">&quot;protocolVersion&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;protocol_version&quot;</span><span class="p">],</span>
</span><span data-line="1103">            <span class="p">}</span>
</span><span data-line="1104">        <span class="p">)</span>
</span><span data-line="1105">
</span><span data-line="1106">        <span class="n">auth_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="1107">            <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span>
</span><span data-line="1108">            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_password</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="s2">&quot;responseData&quot;</span><span class="p">][</span><span class="s2">&quot;publicKeyPem&quot;</span><span class="p">]),</span>
</span><span data-line="1109">        <span class="p">}</span>
</span><span data-line="1110">
</span><span data-line="1111">        <span class="k">return</span> <span class="n">auth_params</span>
</span><span data-line="1112">
</span><span data-line="1113">    <span class="k">def</span> <span class="nf">_login_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1114">        <span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">(</span>
</span><span data-line="1115">            <span class="p">{</span>
</span><span data-line="1116">                <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;loginToken&quot;</span><span class="p">,</span>
</span><span data-line="1117">                <span class="s2">&quot;protocolVersion&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;protocol_version&quot;</span><span class="p">],</span>
</span><span data-line="1118">            <span class="p">}</span>
</span><span data-line="1119">        <span class="p">)</span>
</span><span data-line="1120">
</span><span data-line="1121">        <span class="n">auth_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="1122">
</span><span data-line="1123">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">]:</span>
</span><span data-line="1124">            <span class="n">auth_params</span><span class="p">[</span><span class="s2">&quot;refreshToken&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">]</span>
</span><span data-line="1125">
</span><span data-line="1126">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]:</span>
</span><span data-line="1127">            <span class="n">auth_params</span><span class="p">[</span><span class="s2">&quot;accessToken&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>
</span><span data-line="1128">
</span><span data-line="1129">        <span class="k">return</span> <span class="n">auth_params</span>
</span><span data-line="1130">
</span><span data-line="1131">    <span class="k">def</span> <span class="nf">_encrypt_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">public_key_pem</span><span class="p">):</span>
</span><span data-line="1132">        <span class="n">pk</span> <span class="o">=</span> <span class="n">rsa</span><span class="o">.</span><span class="n">PublicKey</span><span class="o">.</span><span class="n">load_pkcs1</span><span class="p">(</span><span class="n">public_key_pem</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span data-line="1133">        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span>
</span><span data-line="1134">            <span class="n">rsa</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">pk</span><span class="p">)</span>
</span><span data-line="1135">        <span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span data-line="1136">
</span><span data-line="1137">    <span class="k">def</span> <span class="nf">_init_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1138"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1139"><span class="sd">        Init websocket connection</span>
</span><span data-line="1140">
</span><span data-line="1141"><span class="sd">        Note:</span>
</span><span data-line="1142"><span class="sd">            - Connection redundancy is supported</span>
</span><span data-line="1143"><span class="sd">            - Specific Exasol node is randomly selected for every connection attempt</span>
</span><span data-line="1144"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1145">        <span class="n">dsn_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_dsn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;dsn&quot;</span><span class="p">])</span>
</span><span data-line="1146">        <span class="n">failed_attempts</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="1147">        <span class="k">for</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">ipaddr</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">fingerprint</span> <span class="ow">in</span> <span class="n">dsn_items</span><span class="p">:</span>
</span><span data-line="1148">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="1149">                <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_websocket_connection</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">ipaddr</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
</span><span data-line="1150">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="1151">                <span class="n">failed_attempts</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span data-line="1152">                <span class="k">if</span> <span class="n">failed_attempts</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dsn_items</span><span class="p">):</span>
</span><span data-line="1153">                    <span class="k">raise</span> <span class="n">ExaConnectionFailedError</span><span class="p">(</span>
</span><span data-line="1154">                        <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Could not connect to Exasol: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span data-line="1155">                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</span><span data-line="1156">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1157">                <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;socket_timeout&quot;</span><span class="p">])</span>
</span><span data-line="1158">
</span><span data-line="1159">                <span class="bp">self</span><span class="o">.</span><span class="n">ws_ipaddr</span> <span class="o">=</span> <span class="n">ipaddr</span> <span class="ow">or</span> <span class="n">hostname</span>
</span><span data-line="1160">                <span class="bp">self</span><span class="o">.</span><span class="n">ws_port</span> <span class="o">=</span> <span class="n">port</span>
</span><span data-line="1161">
</span><span data-line="1162">                <span class="bp">self</span><span class="o">.</span><span class="n">_ws_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">send</span>
</span><span data-line="1163">                <span class="bp">self</span><span class="o">.</span><span class="n">_ws_recv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">recv</span>
</span><span data-line="1164">
</span><span data-line="1165">                <span class="k">if</span> <span class="n">fingerprint</span><span class="p">:</span>
</span><span data-line="1166">                    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_fingerprint</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span>
</span><span data-line="1167">
</span><span data-line="1168">                <span class="k">return</span>
</span><span data-line="1169">
</span><span data-line="1170">    <span class="k">def</span> <span class="nf">_create_websocket_connection</span><span class="p">(</span>
</span><span data-line="1171">        <span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ipaddr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="1172">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">websocket</span><span class="o">.</span><span class="n">WebSocket</span><span class="p">:</span>
</span><span data-line="1173">        <span class="n">ws_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ws_options</span><span class="p">()</span>
</span><span data-line="1174">        <span class="c1"># Use correct hostname matching IP address for each connection attempt</span>
</span><span data-line="1175">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;encryption&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;resolve_hostnames&quot;</span><span class="p">]:</span>
</span><span data-line="1176">            <span class="n">ws_options</span><span class="p">[</span><span class="s2">&quot;sslopt&quot;</span><span class="p">][</span><span class="s2">&quot;server_hostname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hostname</span>
</span><span data-line="1177">
</span><span data-line="1178">        <span class="n">connection_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_websocket_connection_string</span><span class="p">(</span>
</span><span data-line="1179">            <span class="n">hostname</span><span class="p">,</span> <span class="n">ipaddr</span><span class="p">,</span> <span class="n">port</span>
</span><span data-line="1180">        <span class="p">)</span>
</span><span data-line="1181">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection attempt </span><span class="si">{</span><span class="n">connection_string</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1182">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1183">            <span class="k">return</span> <span class="n">websocket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">connection_string</span><span class="p">,</span> <span class="o">**</span><span class="n">ws_options</span><span class="p">)</span>
</span><span data-line="1184">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="1185">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect [</span><span class="si">{</span><span class="n">connection_string</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1186">            <span class="k">raise</span> <span class="n">e</span>
</span><span data-line="1187">
</span><span data-line="1188">    <span class="k">def</span> <span class="nf">_get_websocket_connection_string</span><span class="p">(</span>
</span><span data-line="1189">        <span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ipaddr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="1190">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="1191">        <span class="n">host</span> <span class="o">=</span> <span class="n">hostname</span>
</span><span data-line="1192">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;resolve_hostnames&quot;</span><span class="p">]:</span>
</span><span data-line="1193">            <span class="k">if</span> <span class="n">ipaddr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1194">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;IP address was not resolved&quot;</span><span class="p">)</span>
</span><span data-line="1195">            <span class="n">host</span> <span class="o">=</span> <span class="n">ipaddr</span>
</span><span data-line="1196">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;encryption&quot;</span><span class="p">]:</span>
</span><span data-line="1197">            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;wss://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="1198">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1199">            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ws://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="1200">
</span><span data-line="1201">    <span class="k">def</span> <span class="nf">_get_ws_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1202">        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="1203">            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;connection_timeout&quot;</span><span class="p">],</span>
</span><span data-line="1204">            <span class="s2">&quot;skip_utf8_validation&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="1205">            <span class="s2">&quot;enable_multithread&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Extra lock is necessary to protect abort_query() calls</span>
</span><span data-line="1206">        <span class="p">}</span>
</span><span data-line="1207">
</span><span data-line="1208">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;encryption&quot;</span><span class="p">]:</span>
</span><span data-line="1209">            <span class="c1"># Use &quot;websocket_sslopt&quot; argument to set custom SSL options, which are passed directly to WebSocket client constructor</span>
</span><span data-line="1210">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;websocket_sslopt&quot;</span><span class="p">]:</span>
</span><span data-line="1211">                <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sslopt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;websocket_sslopt&quot;</span><span class="p">]</span>
</span><span data-line="1212">            <span class="c1"># OpenID tokens are normally used for Exasol SAAS</span>
</span><span data-line="1213">            <span class="c1"># Strict certificate verification is enabled by default</span>
</span><span data-line="1214">            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">]:</span>
</span><span data-line="1215">                <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sslopt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cert_reqs&quot;</span><span class="p">:</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span><span class="p">}</span>
</span><span data-line="1216">            <span class="c1"># Certification verification is disabled for other use cases (e.g. Docker container, &quot;on-premises&quot; Exasol setup)</span>
</span><span data-line="1217">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1218">                <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sslopt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cert_reqs&quot;</span><span class="p">:</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span><span class="p">}</span>
</span><span data-line="1219">
</span><span data-line="1220">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;http_proxy&quot;</span><span class="p">]:</span>
</span><span data-line="1221">            <span class="n">proxy_components</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;http_proxy&quot;</span><span class="p">])</span>
</span><span data-line="1222">
</span><span data-line="1223">            <span class="k">if</span> <span class="n">proxy_components</span><span class="o">.</span><span class="n">hostname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1224">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not parse http_proxy&quot;</span><span class="p">)</span>
</span><span data-line="1225">
</span><span data-line="1226">            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;http_proxy_host&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy_components</span><span class="o">.</span><span class="n">hostname</span>
</span><span data-line="1227">            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;http_proxy_port&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy_components</span><span class="o">.</span><span class="n">port</span>
</span><span data-line="1228">            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;http_proxy_auth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1229">                <span class="n">proxy_components</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
</span><span data-line="1230">                <span class="n">proxy_components</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span data-line="1231">            <span class="p">)</span>
</span><span data-line="1232">
</span><span data-line="1233">        <span class="k">return</span> <span class="n">options</span>
</span><span data-line="1234">
</span><span data-line="1235">    <span class="k">def</span> <span class="nf">_get_login_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1236">        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="1237">            <span class="s2">&quot;currentSchema&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]),</span>
</span><span data-line="1238">            <span class="s2">&quot;autocommit&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;autocommit&quot;</span><span class="p">],</span>
</span><span data-line="1239">            <span class="s2">&quot;queryTimeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;query_timeout&quot;</span><span class="p">],</span>
</span><span data-line="1240">        <span class="p">}</span>
</span><span data-line="1241">
</span><span data-line="1242">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;snapshot_transactions&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1243">            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;snapshotTransactionsEnabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span>
</span><span data-line="1244">                <span class="s2">&quot;snapshot_transactions&quot;</span>
</span><span data-line="1245">            <span class="p">]</span>
</span><span data-line="1246">
</span><span data-line="1247">        <span class="k">return</span> <span class="n">attributes</span>
</span><span data-line="1248">
</span><span data-line="1249">    <span class="k">def</span> <span class="nf">_process_dsn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsn</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Host</span><span class="p">]:</span>
</span><span data-line="1250"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1251"><span class="sd">        Parse DSN, expand ranges and resolve IP addresses for all hostnames.</span>
</span><span data-line="1252">
</span><span data-line="1253"><span class="sd">        Note:</span>
</span><span data-line="1254"><span class="sd">            Randomness is required to guarantee proper distribution of workload across all nodes</span>
</span><span data-line="1255">
</span><span data-line="1256"><span class="sd">        Returns:</span>
</span><span data-line="1257"><span class="sd">            List of (hostname, ip_address, port) tuples in random order</span>
</span><span data-line="1258"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1259">        <span class="k">if</span> <span class="n">dsn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dsn</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="1260">            <span class="k">raise</span> <span class="n">ExaConnectionDsnError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Connection string is empty&quot;</span><span class="p">)</span>
</span><span data-line="1261">
</span><span data-line="1262">        <span class="n">current_port</span> <span class="o">=</span> <span class="n">constant</span><span class="o">.</span><span class="n">DEFAULT_PORT</span>
</span><span data-line="1263">        <span class="n">current_fingerprint</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1264">
</span><span data-line="1265">        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="1266">
</span><span data-line="1267">        <span class="n">dsn_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
</span><span data-line="1268">            <span class="sa">r</span><span class="s2">&quot;^(?P&lt;hostname_prefix&gt;.+?)&quot;</span>
</span><span data-line="1269">            <span class="c1"># Optional range (e.g. myxasol1..4.com)</span>
</span><span data-line="1270">            <span class="sa">r</span><span class="s2">&quot;(?:(?P&lt;range_start&gt;\d+)\.\.(?P&lt;range_end&gt;\d+)(?P&lt;hostname_suffix&gt;.*?))?&quot;</span>
</span><span data-line="1271">            <span class="c1"># Optional fingerprint (e.g. myexasol1..4.com/135a1d2dce102de866f58267521f4232153545a075dc85f8f7596f57e588a181)</span>
</span><span data-line="1272">            <span class="sa">r</span><span class="s2">&quot;(?:/(?P&lt;fingerprint&gt;[0-9A-Fa-f]+))?&quot;</span>
</span><span data-line="1273">            <span class="c1"># Optional port (e.g. myexasol1..4.com:8564)</span>
</span><span data-line="1274">            <span class="sa">r</span><span class="s2">&quot;(?::(?P&lt;port&gt;\d+)?)?$&quot;</span>
</span><span data-line="1275">        <span class="p">)</span>
</span><span data-line="1276">
</span><span data-line="1277">        <span class="c1"># Port is applied backwards, so we iterate the whole list backwards to avoid second loop</span>
</span><span data-line="1278">        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">dsn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)):</span>
</span><span data-line="1279">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="1280">                <span class="k">continue</span>
</span><span data-line="1281">
</span><span data-line="1282">            <span class="n">m</span> <span class="o">=</span> <span class="n">dsn_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
</span><span data-line="1283">
</span><span data-line="1284">            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
</span><span data-line="1285">                <span class="k">raise</span> <span class="n">ExaConnectionDsnError</span><span class="p">(</span>
</span><span data-line="1286">                    <span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not parse connection string part [</span><span class="si">{</span><span class="n">part</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span data-line="1287">                <span class="p">)</span>
</span><span data-line="1288">
</span><span data-line="1289">            <span class="c1"># Optional port</span>
</span><span data-line="1290">            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">):</span>
</span><span data-line="1291">                <span class="n">current_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">))</span>
</span><span data-line="1292">
</span><span data-line="1293">            <span class="c1"># Optional fingerprint</span>
</span><span data-line="1294">            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;fingerprint&quot;</span><span class="p">):</span>
</span><span data-line="1295">                <span class="n">current_fingerprint</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;fingerprint&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span data-line="1296">
</span><span data-line="1297">                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;encryption&quot;</span><span class="p">]:</span>
</span><span data-line="1298">                    <span class="k">raise</span> <span class="n">ExaConnectionDsnError</span><span class="p">(</span>
</span><span data-line="1299">                        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1300">                        <span class="s2">&quot;Fingerprint was specified in connection string, but encryption is not enabled&quot;</span><span class="p">,</span>
</span><span data-line="1301">                    <span class="p">)</span>
</span><span data-line="1302">
</span><span data-line="1303">            <span class="c1"># Hostname or IP range was specified, expand it</span>
</span><span data-line="1304">            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;range_start&quot;</span><span class="p">):</span>
</span><span data-line="1305">                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;range_start&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;range_end&quot;</span><span class="p">)):</span>
</span><span data-line="1306">                    <span class="k">raise</span> <span class="n">ExaConnectionDsnError</span><span class="p">(</span>
</span><span data-line="1307">                        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1308">                        <span class="sa">f</span><span class="s2">&quot;Connection string part [</span><span class="si">{</span><span class="n">part</span><span class="si">}</span><span class="s2">] contains an invalid range, &quot;</span>
</span><span data-line="1309">                        <span class="sa">f</span><span class="s2">&quot;lower bound is higher than upper bound&quot;</span><span class="p">,</span>
</span><span data-line="1310">                    <span class="p">)</span>
</span><span data-line="1311">
</span><span data-line="1312">                <span class="n">zfill_width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;range_start&quot;</span><span class="p">))</span>
</span><span data-line="1313">
</span><span data-line="1314">                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span data-line="1315">                    <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;range_start&quot;</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;range_end&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
</span><span data-line="1316">                <span class="p">):</span>
</span><span data-line="1317">                    <span class="n">hostname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;hostname_prefix&#39;</span><span class="p">)</span><span class="si">}{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">zfill_width</span><span class="p">)</span><span class="si">}{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;hostname_suffix&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="1318">                    <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span data-line="1319">                        <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_hostname</span><span class="p">(</span>
</span><span data-line="1320">                            <span class="n">hostname</span><span class="p">,</span> <span class="n">current_port</span><span class="p">,</span> <span class="n">current_fingerprint</span>
</span><span data-line="1321">                        <span class="p">)</span>
</span><span data-line="1322">                    <span class="p">)</span>
</span><span data-line="1323">            <span class="c1"># Just a single hostname or single IP address</span>
</span><span data-line="1324">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1325">                <span class="n">hostname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;hostname_prefix&quot;</span><span class="p">)</span>
</span><span data-line="1326">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;resolve_hostnames&quot;</span><span class="p">]:</span>
</span><span data-line="1327">                    <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span data-line="1328">                        <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_hostname</span><span class="p">(</span>
</span><span data-line="1329">                            <span class="n">hostname</span><span class="p">,</span> <span class="n">current_port</span><span class="p">,</span> <span class="n">current_fingerprint</span>
</span><span data-line="1330">                        <span class="p">)</span>
</span><span data-line="1331">                    <span class="p">)</span>
</span><span data-line="1332">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="1333">                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="1334">                        <span class="n">Host</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">current_port</span><span class="p">,</span> <span class="n">current_fingerprint</span><span class="p">)</span>
</span><span data-line="1335">                    <span class="p">)</span>
</span><span data-line="1336">
</span><span data-line="1337">        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span data-line="1338">
</span><span data-line="1339">        <span class="k">return</span> <span class="n">result</span>
</span><span data-line="1340">
</span><span data-line="1341">    <span class="k">def</span> <span class="nf">_resolve_hostname</span><span class="p">(</span>
</span><span data-line="1342">        <span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="1343">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Host</span><span class="p">]:</span>
</span><span data-line="1344"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1345"><span class="sd">        Resolve all IP addresses for hostname and add port.</span>
</span><span data-line="1346">
</span><span data-line="1347"><span class="sd">        Warnings:</span>
</span><span data-line="1348"><span class="sd">            - It also implicitly checks that all hostnames mentioned in DSN can be resolved</span>
</span><span data-line="1349"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1350">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1351">            <span class="n">hostname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ipaddr_list</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
</span><span data-line="1352">        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="1353">            <span class="k">raise</span> <span class="n">ExaConnectionDsnError</span><span class="p">(</span>
</span><span data-line="1354">                <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1355">                <span class="sa">f</span><span class="s2">&quot;Could not resolve IP address of hostname [</span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s2">] &quot;</span>
</span><span data-line="1356">                <span class="sa">f</span><span class="s2">&quot;derived from connection string&quot;</span><span class="p">,</span>
</span><span data-line="1357">            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</span><span data-line="1358">
</span><span data-line="1359">        <span class="k">return</span> <span class="p">[</span><span class="n">Host</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">ipaddr</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">)</span> <span class="k">for</span> <span class="n">ipaddr</span> <span class="ow">in</span> <span class="n">ipaddr_list</span><span class="p">]</span>
</span><span data-line="1360">
</span><span data-line="1361">    <span class="k">def</span> <span class="nf">_validate_fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provided_fingerprint</span><span class="p">):</span>
</span><span data-line="1362">        <span class="n">server_fingerprint</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1363">            <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">getpeercert</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span data-line="1364">        <span class="p">)</span>
</span><span data-line="1365">
</span><span data-line="1366">        <span class="k">if</span> <span class="n">provided_fingerprint</span> <span class="o">!=</span> <span class="n">server_fingerprint</span><span class="p">:</span>
</span><span data-line="1367">            <span class="k">raise</span> <span class="n">ExaConnectionFailedError</span><span class="p">(</span>
</span><span data-line="1368">                <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1369">                <span class="sa">f</span><span class="s2">&quot;Provided fingerprint [</span><span class="si">{</span><span class="n">provided_fingerprint</span><span class="si">}</span><span class="s2">] did not match &quot;</span>
</span><span data-line="1370">                <span class="sa">f</span><span class="s2">&quot;server fingerprint [</span><span class="si">{</span><span class="n">server_fingerprint</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span>
</span><span data-line="1371">            <span class="p">)</span>
</span><span data-line="1372">
</span><span data-line="1373">    <span class="k">def</span> <span class="nf">_init_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1374">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cls_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constant</span><span class="o">.</span><span class="n">DRIVER_NAME</span><span class="p">)</span>
</span><span data-line="1375">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">)</span>
</span><span data-line="1376">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">add_default_handler</span><span class="p">()</span>
</span><span data-line="1377">
</span><span data-line="1378">    <span class="k">def</span> <span class="nf">_init_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1379">        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cls_formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="1380">
</span><span data-line="1381">    <span class="k">def</span> <span class="nf">_init_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1382">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;json_lib&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;rapidjson&quot;</span><span class="p">:</span>
</span><span data-line="1383">            <span class="kn">import</span> <span class="nn">rapidjson</span>
</span><span data-line="1384">
</span><span data-line="1385">            <span class="bp">self</span><span class="o">.</span><span class="n">json_encode</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">:</span> <span class="n">rapidjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
</span><span data-line="1386">                <span class="n">x</span><span class="p">,</span>
</span><span data-line="1387">                <span class="n">number_mode</span><span class="o">=</span><span class="n">rapidjson</span><span class="o">.</span><span class="n">NM_NATIVE</span><span class="p">,</span>
</span><span data-line="1388">                <span class="n">indent</span><span class="o">=</span><span class="mi">2</span> <span class="k">if</span> <span class="n">indent</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1389">                <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="1390">            <span class="p">)</span>
</span><span data-line="1391">            <span class="bp">self</span><span class="o">.</span><span class="n">json_decode</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">rapidjson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
</span><span data-line="1392">                <span class="n">x</span><span class="p">,</span> <span class="n">number_mode</span><span class="o">=</span><span class="n">rapidjson</span><span class="o">.</span><span class="n">NM_NATIVE</span>
</span><span data-line="1393">            <span class="p">)</span>
</span><span data-line="1394">
</span><span data-line="1395">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;json_lib&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ujson&quot;</span><span class="p">:</span>
</span><span data-line="1396">            <span class="kn">import</span> <span class="nn">ujson</span>
</span><span data-line="1397">
</span><span data-line="1398">            <span class="bp">self</span><span class="o">.</span><span class="n">json_encode</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">:</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
</span><span data-line="1399">                <span class="n">x</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span> <span class="k">if</span> <span class="n">indent</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span>
</span><span data-line="1400">            <span class="p">)</span>
</span><span data-line="1401">            <span class="bp">self</span><span class="o">.</span><span class="n">json_decode</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ujson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span data-line="1402">
</span><span data-line="1403">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;json_lib&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;orjson&quot;</span><span class="p">:</span>
</span><span data-line="1404">            <span class="kn">import</span> <span class="nn">orjson</span>
</span><span data-line="1405">
</span><span data-line="1406">            <span class="bp">self</span><span class="o">.</span><span class="n">json_encode</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">:</span> <span class="n">orjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
</span><span data-line="1407">                <span class="n">x</span><span class="p">,</span>
</span><span data-line="1408">                <span class="n">option</span><span class="o">=</span><span class="n">orjson</span><span class="o">.</span><span class="n">OPT_INDENT_2</span> <span class="o">|</span> <span class="n">orjson</span><span class="o">.</span><span class="n">OPT_APPEND_NEWLINE</span> <span class="k">if</span> <span class="n">indent</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span data-line="1409">            <span class="p">)</span>
</span><span data-line="1410">            <span class="bp">self</span><span class="o">.</span><span class="n">json_decode</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">orjson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span data-line="1411">
</span><span data-line="1412">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;json_lib&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
</span><span data-line="1413">            <span class="kn">import</span> <span class="nn">json</span>
</span><span data-line="1414">
</span><span data-line="1415">            <span class="bp">self</span><span class="o">.</span><span class="n">json_encode</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
</span><span data-line="1416">                <span class="n">x</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span> <span class="k">if</span> <span class="n">indent</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span>
</span><span data-line="1417">            <span class="p">)</span>
</span><span data-line="1418">            <span class="bp">self</span><span class="o">.</span><span class="n">json_decode</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span data-line="1419">
</span><span data-line="1420">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1421">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported json library [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;json_lib&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</span><span data-line="1422">
</span><span data-line="1423">    <span class="k">def</span> <span class="nf">_init_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1424">        <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cls_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="1425">
</span><span data-line="1426">    <span class="k">def</span> <span class="nf">_init_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1427">        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cls_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="1428">
</span><span data-line="1429">    <span class="k">def</span> <span class="nf">_get_stmt_output_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1430">        <span class="kn">import</span> <span class="nn">pathlib</span>
</span><span data-line="1431">        <span class="kn">import</span> <span class="nn">tempfile</span>
</span><span data-line="1432">
</span><span data-line="1433">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;udf_output_dir&quot;</span><span class="p">]:</span>
</span><span data-line="1434">            <span class="n">base_output_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;udf_output_dir&quot;</span><span class="p">]</span>
</span><span data-line="1435">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1436">            <span class="n">base_output_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
</span><span data-line="1437">
</span><span data-line="1438">        <span class="c1"># Create unique sub-directory for every statement of every session</span>
</span><span data-line="1439">        <span class="bp">self</span><span class="o">.</span><span class="n">_udf_output_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span data-line="1440">
</span><span data-line="1441">        <span class="n">stmt_output_dir</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1442">            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">base_output_dir</span><span class="p">)</span>
</span><span data-line="1443">            <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_udf_output_count</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="1444">        <span class="p">)</span>
</span><span data-line="1445">        <span class="n">stmt_output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="1446">
</span><span data-line="1447">        <span class="k">return</span> <span class="n">stmt_output_dir</span>
</span><span data-line="1448">
</span><span data-line="1449">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1450">        <span class="k">return</span> <span class="p">(</span>
</span><span data-line="1451">            <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> session_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="1452">            <span class="sa">f</span><span class="s2">&quot; dsn=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;dsn&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> user=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span data-line="1453">        <span class="p">)</span>
</span><span data-line="1454">
</span><span data-line="1455">    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1456">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="1457">
</span><span data-line="1458">    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
</span><span data-line="1459">        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span data-line="1460">
</span><span data-line="1461">    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1462"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1463"><span class="sd">        Will close the connection.</span>
</span><span data-line="1464">
</span><span data-line="1465"><span class="sd">        Note:</span>
</span><span data-line="1466"><span class="sd">            close() is being called automatically in order to:</span>
</span><span data-line="1467">
</span><span data-line="1468"><span class="sd">            #.  send OP_CLOSE frame to Exasol server rather than silently terminating the socket on client side</span>
</span><span data-line="1469"><span class="sd">            #.  make sure connection is closed immediately even if garbage collection was disabled for any reasons</span>
</span><span data-line="1470"><span class="sd">            #.  write debug logs</span>
</span><span data-line="1471"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1472">        <span class="c1"># Based on our investigations, two scenarios have emerged, one of which does not function correctly:</span>
</span><span data-line="1473">        <span class="c1">#</span>
</span><span data-line="1474">        <span class="c1"># 1. `__del__` is invoked during a regular garbage collector run while the process remains active.</span>
</span><span data-line="1475">        <span class="c1"># 2. `__del__` is invoked during interpreter shutdown (throws an exception).</span>
</span><span data-line="1476">        <span class="c1">#     * This leads to a minor residual on the database, which will automatically be cleared up within a couple of hours</span>
</span><span data-line="1477">        <span class="c1">#</span>
</span><span data-line="1478">        <span class="c1"># In situations where interpreter shutdown occurs while a connection remains unclosed</span>
</span><span data-line="1479">        <span class="c1"># due to not being addressed during a regular garbage collector run or manual close,</span>
</span><span data-line="1480">        <span class="c1"># the error scenario (2.) will be triggered.</span>
</span><span data-line="1481">        <span class="c1">#</span>
</span><span data-line="1482">        <span class="c1"># The issue arises because during interpreter shutdown, orderly deletion is not guaranteed</span>
</span><span data-line="1483">        <span class="c1"># (see also [Python documentation](https://docs.python.org/3/reference/datamodel.html#object.__del__) and</span>
</span><span data-line="1484">        <span class="c1"># [C-API documentation](https://docs.python.org/3/c-api/init.html#c.Py_FinalizeEx)).</span>
</span><span data-line="1485">        <span class="c1"># Consequently, scenarios may occur where the underlying socket is already closed or cleaned up while</span>
</span><span data-line="1486">        <span class="c1"># the connection still tries using it (see [#108](https://github.com/exasol/pyexasol/issues/108)).</span>
</span><span data-line="1487">        <span class="c1">#</span>
</span><span data-line="1488">        <span class="c1"># Despite this problem, having a `__del__` method that performs cleanup remains valuable,</span>
</span><span data-line="1489">        <span class="c1"># particularly in the context of long-running processes, to prevent resource leaks.</span>
</span><span data-line="1490">        <span class="c1">#</span>
</span><span data-line="1491">        <span class="c1"># Possible alternative solutions to address this would be:</span>
</span><span data-line="1492">        <span class="c1"># * Within the catch, report a clear error message that the user did not close all the connections which were opened.</span>
</span><span data-line="1493">        <span class="c1"># * Remove the `__del__` function to &quot;force&quot; the user to always address open/close in a clean manner.</span>
</span><span data-line="1494">        <span class="c1">#</span>
</span><span data-line="1495">        <span class="c1"># Still, the feedback we received from users so far indicates that neither alternative is desirable for them.</span>
</span><span data-line="1496">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1497">            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span data-line="1498">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span data-line="1499">            <span class="k">pass</span></div>

</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2024, Exasol</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/exasol/pyexasol" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../_static/shibuya.js?v=55e26b35"></script></body>
</html>